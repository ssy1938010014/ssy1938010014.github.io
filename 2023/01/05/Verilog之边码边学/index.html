<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css">
  <script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"xn--ssy-lq6e63gg6fuu2d.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="本文主要利用Vivado工具，在码代码并仿真的过程中学习Verilog的知识点以及设计思路">
<meta property="og:type" content="article">
<meta property="og:title" content="Verilog之边码边学">
<meta property="og:url" content="http://ssy的小天地.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/index.html">
<meta property="og:site_name" content="ssy的小天地">
<meta property="og:description" content="本文主要利用Vivado工具，在码代码并仿真的过程中学习Verilog的知识点以及设计思路">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230105133849414.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230105133924479.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230106162208489.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230106162114767.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230108234158354.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230108234846962.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230108235053079.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230108235240084.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230108234639688.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230109104555400.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230109110344324.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230109112028556.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230109113345645.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230109122519817.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230109194755161.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230109194540797.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230109194734655.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230203164007128.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230203165642299.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230203165922892.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230203170228814.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230203170655478.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230203170929138.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230203171454609.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230203171705965.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230203172000521.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230203174713842.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230203175346897.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230203180812501.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230203194948495.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230204220423725.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230204224322669.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230204234624012.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230205235810859.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230206000138514.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230206000713569.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/%E8%B6%85%E5%A3%B0%E6%B3%A2%E6%B5%8B%E8%B7%9D%E6%A8%A1%E5%9D%97-1675668397252-2.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/%E7%AB%AF%E5%8F%A3%E5%88%92%E5%88%86%E4%B8%8E%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89-1675669738038-5.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230206163556109.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230206164233042.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230206164149984.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230206165117621.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230206171150590.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/%E8%87%AA%E5%8A%A8%E5%94%AE%E5%8D%96%E6%9C%BA%E7%8A%B6%E6%80%81%E8%BD%AC%E5%8C%96%E5%9B%BE-1675676111194-8.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230206174427148.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230206175550881.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/%E6%A8%A1%E5%9D%97%E5%88%92%E5%88%86%E4%B8%8E%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/%E4%B8%B2%E5%8F%A3%E6%8E%A5%E6%94%B6%E4%B8%B2%E5%B9%B6%E8%BD%AC%E6%8D%A2%E6%97%B6%E5%BA%8F.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/%E8%AF%91%E7%A0%81%E6%A8%A1%E5%9D%97%E7%8A%B6%E6%80%81%E8%BD%AC%E6%8D%A2%E5%9B%BE.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230206210526508.png">
<meta property="og:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230206211033267.png">
<meta property="article:published_time" content="2023-01-05T02:07:12.000Z">
<meta property="article:modified_time" content="2023-12-16T18:38:46.945Z">
<meta property="article:author" content="ssy">
<meta property="article:tag" content="Verilog">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://xn--ssy-lq6e63gg6fuu2d.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230105133849414.png">

<link rel="canonical" href="http://ssy的小天地.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Verilog之边码边学 | ssy的小天地</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

  <!--pjax：防止跳转页面音乐暂停-->
  <script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.js"></script>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
    <a target="_blank" rel="noopener" href="https://github.com/ssy1938010014" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">ssy的小天地</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">愿汝如是 千金不换</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-works">

    <a href="/works/" rel="section"><i class="fa fa-fw fa-sitemap"></i>文章</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://ssy的小天地.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ssy.png">
      <meta itemprop="name" content="ssy">
      <meta itemprop="description" content="满怀希望 就会所向披靡">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ssy的小天地">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Verilog之边码边学
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">



              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-01-05 10:07:12" itemprop="dateCreated datePublished" datetime="2023-01-05T10:07:12+08:00">2023-01-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-17 02:38:46" itemprop="dateModified" datetime="2023-12-17T02:38:46+08:00">2023-12-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%A7%AF%E7%B4%AF/" itemprop="url" rel="index"><span itemprop="name">学习积累</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>本文主要利用Vivado工具，在码代码并仿真的过程中学习Verilog的知识点以及设计思路</p>
<span id="more"></span>

<h1 id="分频计数器设计"><a href="#分频计数器设计" class="headerlink" title="分频计数器设计"></a>分频计数器设计</h1><ul>
<li>将输入时钟100MHZ分频形成1MHZ</li>
</ul>
<h2 id="1-关键点"><a href="#1-关键点" class="headerlink" title="1.关键点"></a>1.关键点</h2><ul>
<li><p>最大计数值CNT_MAX为$\frac{输入时钟频率}{分频得到的频率}$，计数时从0计数到CNT_MAX-1</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//产生0~100的时钟计数器</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!rst_n)</span><br><span class="line">        cnt_clk&lt;=<span class="number">8&#x27;d0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(cnt_clk&lt;(`CNT_MAX-<span class="number">1</span>))<span class="comment">//从0计到99(cnt_clk为99时，其会消耗一个时钟周期回到0)，故总共消耗100个时钟周期</span></span><br><span class="line">        cnt_clk&lt;=cnt_clk+<span class="number">1&#x27;b1</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        cnt_clk&lt;=<span class="number">8&#x27;d0</span>;  </span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<ul>
<li>上面代码看上去是不是像从0计数到98，但是当cnt_clk等于99时，也会进入这段代码，只是之后cnt_clk的值变为了0，故实际上这段代码是从0计数到99</li>
</ul>
</li>
<li><p>产生分频时钟，计数为0-49时为高电平，计数为50-99时为低电平</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//产生1MHZ的时钟</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!rst_n)</span><br><span class="line">        clk_1mhz&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(cnt_clk&lt;`CNT_MAX_div2)<span class="comment">//从0计到49，总共花费50个时钟周期</span></span><br><span class="line">        clk_1mhz&lt;=<span class="number">1&#x27;b1</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        clk_1mhz&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<ul>
<li>上述分频时钟的产生实际上会比计数器的产生延时一个系统时钟周期，因为计数器cnt_clk在时钟上升沿变化时，不会被立马捕捉到，只有在再下一个时钟周期时，才能捕捉到变化后的值</li>
</ul>
</li>
</ul>
<h2 id="2-源代码"><a href="#2-源代码" class="headerlink" title="2.源代码"></a>2.源代码</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">define</span> CNT_MAX 100</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> CNT_MAX_div2 `CNT_MAX/2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> vlg_design(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> rst_n,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> clk_1mhz</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] cnt_clk;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//产生0~100的时钟计数器</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(!rst_n)</span><br><span class="line">            cnt_clk&lt;=<span class="number">8&#x27;d0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(cnt_clk&lt;(`CNT_MAX-<span class="number">1</span>))<span class="comment">//从0计到99(cnt_clk为99时，其会消耗一个时钟周期回到0)，故总共消耗100个时钟周期</span></span><br><span class="line">            cnt_clk&lt;=cnt_clk+<span class="number">1&#x27;b1</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            cnt_clk&lt;=<span class="number">8&#x27;d0</span>;  </span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">//产生1MHZ的时钟</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(!rst_n)</span><br><span class="line">            clk_1mhz&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(cnt_clk&lt;`CNT_MAX_div2)<span class="comment">//从0计到49，总共花费50个时钟周期</span></span><br><span class="line">            clk_1mhz&lt;=<span class="number">1&#x27;b1</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            clk_1mhz&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">     </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="3-Testbench"><a href="#3-Testbench" class="headerlink" title="3.Testbench"></a>3.Testbench</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> CLK_PERIOD 10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> vlg_design_tb;</span><br><span class="line">    <span class="keyword">reg</span> clk;</span><br><span class="line">    <span class="keyword">reg</span> rst_n;</span><br><span class="line">    <span class="keyword">wire</span> clk_1mhz;</span><br><span class="line">    </span><br><span class="line">    vlg_design vlg(</span><br><span class="line">        <span class="variable">.clk</span>(clk),</span><br><span class="line">        <span class="variable">.rst_n</span>(rst_n),</span><br><span class="line">        <span class="variable">.clk_1mhz</span>(clk_1mhz)</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//时钟信号的产生</span></span><br><span class="line">    <span class="keyword">initial</span> clk=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">always</span> <span class="variable">#(`CLK_PERIOD/2)</span> clk=~clk;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        rst_n=<span class="number">0</span>;</span><br><span class="line">        #<span class="number">1000</span> rst_n=<span class="number">1</span>;</span><br><span class="line">        #<span class="number">10_000</span> <span class="built_in">$stop</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="4-仿真结果"><a href="#4-仿真结果" class="headerlink" title="4.仿真结果"></a>4.仿真结果</h2><p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230105133849414.png" alt="image-20230105133849414"></p>
<p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230105133924479.png" alt="image-20230105133924479"></p>
<ul>
<li>由仿真结果可以很明显看到cnt_clk是从0-99计数，且输出的分频时钟延时了一个周期，看上去是从1-50为高电平</li>
</ul>
<hr>
<h1 id="使能时钟设计"><a href="#使能时钟设计" class="headerlink" title="使能时钟设计"></a>使能时钟设计</h1><ul>
<li>输入时钟100MHz，产生一个5MHz的时钟使能信号，并使能此时钟使能信号进行0~15的周期计数</li>
</ul>
<h2 id="1-关键点-1"><a href="#1-关键点-1" class="headerlink" title="1.关键点"></a>1.关键点</h2><ul>
<li><p>时钟使能信号只是持续了一个时钟周期，故用<code>divcnt==(DIVCNT_MAX-1)</code>来判断是否拉高</p>
</li>
<li><p>时序逻辑中，数据变化时，其他模块获取不到该数据变化的值，只有在下一个时钟周期时才能获取变化后的值，也就是相应数据的变化会在对应数据持续一个时钟周期之后再改变</p>
</li>
</ul>
<h2 id="2-源代码-1"><a href="#2-源代码-1" class="headerlink" title="2.源代码"></a>2.源代码</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> clk_en(</span><br><span class="line">    clk,</span><br><span class="line">    rst_n,</span><br><span class="line">    cnt</span><br><span class="line">);</span><br><span class="line">    <span class="comment">////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//输入输出端口的定义</span></span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> clk;</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> rst_n;</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] cnt;<span class="comment">//输出计数器</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//中间变量的定义</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">4</span>:<span class="number">0</span>] divcnt;<span class="comment">//分频计数器</span></span><br><span class="line">    <span class="keyword">localparam</span> DIVCNT_MAX = <span class="number">5&#x27;d20</span>;<span class="comment">//完成分频需要计数的最大值</span></span><br><span class="line">    <span class="keyword">reg</span> clk_en;</span><br><span class="line"></span><br><span class="line">    <span class="comment">///////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//计数器计数模块</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(!rst_n)</span><br><span class="line">            divcnt&lt;=<span class="number">5&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(divcnt&lt;(DIVCNT_MAX-<span class="number">1</span>))</span><br><span class="line">            divcnt&lt;=divcnt+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            divcnt&lt;=<span class="number">5&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//时钟使能信号产生模块</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(!rst_n)</span><br><span class="line">            clk_en&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(divcnt==(DIVCNT_MAX-<span class="number">1</span>))</span><br><span class="line">            clk_en&lt;=<span class="number">1&#x27;b1</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            clk_en&lt;=<span class="number">1&#x27;b0</span>;            </span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//时钟使能信号使能计数模块</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(!rst_n)</span><br><span class="line">            cnt&lt;=<span class="number">4&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(clk_en==<span class="number">1&#x27;b1</span>)</span><br><span class="line">            cnt&lt;=cnt+<span class="number">1&#x27;b1</span>;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            cnt&lt;=cnt;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="3-Testbench-1"><a href="#3-Testbench-1" class="headerlink" title="3.Testbench"></a>3.Testbench</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> CLK_PERIOD 10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> clk_en_tb;</span><br><span class="line">    <span class="keyword">reg</span> clk;</span><br><span class="line">    <span class="keyword">reg</span> rst_n;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] cnt;</span><br><span class="line">    </span><br><span class="line">    clk_en clk_en_U1(</span><br><span class="line">        <span class="variable">.clk</span>(clk),</span><br><span class="line">        <span class="variable">.rst_n</span>(rst_n),</span><br><span class="line">        <span class="variable">.cnt</span>(cnt)</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//时钟信号的产生</span></span><br><span class="line">    <span class="keyword">initial</span> clk=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">always</span> <span class="variable">#(`CLK_PERIOD/2)</span> clk=~clk;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        rst_n=<span class="number">0</span>;</span><br><span class="line">        #<span class="number">1000</span> rst_n=<span class="number">1</span>;</span><br><span class="line">        #<span class="number">33_000</span> <span class="built_in">$stop</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="4-仿真结果-1"><a href="#4-仿真结果-1" class="headerlink" title="4.仿真结果"></a>4.仿真结果</h2><p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230106162208489.png" alt="image-20230106162208489"></p>
<p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230106162114767.png" alt="image-20230106162114767"></p>
<hr>
<h1 id="基于Xlinx-BUFGCE原语的门控时钟设计"><a href="#基于Xlinx-BUFGCE原语的门控时钟设计" class="headerlink" title="基于Xlinx BUFGCE原语的门控时钟设计"></a>基于Xlinx BUFGCE原语的门控时钟设计</h1><ul>
<li>FPGA系统时钟100MHz，系统每秒进行一次数据采集与处理，每次维持10ms，其余时间空闲，在空闲时间内希望关闭100MHz的工作时钟</li>
</ul>
<img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230108234158354.png" alt="image-20230108234158354" style="zoom: 50%;">

<h2 id="1-关键点-2"><a href="#1-关键点-2" class="headerlink" title="1.关键点"></a>1.关键点</h2><ul>
<li><p>BUFGCE原语的例化</p>
<img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230108234846962.png" alt="image-20230108234846962" style="zoom: 67%;">

<img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230108235053079.png" alt="image-20230108235053079" style="zoom: 50%;">

<img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230108235240084.png" alt="image-20230108235240084" style="zoom:50%;">
</li>
<li><p><strong>利用define、ifdef、endif语句方便仿真测试</strong></p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">define</span> SIMULATION</span><span class="comment">//在真实情况下运行时，将此行注释掉就行</span></span><br><span class="line"><span class="meta">`<span class="keyword">ifdef</span> SIMULATION</span></span><br><span class="line"><span class="comment">//仿真情况下用较小的计数值代替，不然仿真时间过长</span></span><br><span class="line"><span class="keyword">localparam</span> TIMER_CNT_1s = <span class="number">30&#x27;d1_000</span>-<span class="number">1&#x27;b1</span>;<span class="comment">//1s计数的最大值</span></span><br><span class="line"><span class="keyword">localparam</span> TIMER_CNT_10ms=<span class="number">30&#x27;d1_0</span>-<span class="number">1&#x27;b1</span>;<span class="comment">//10ms计数的最大值 </span></span><br><span class="line"><span class="meta">`<span class="keyword">else</span></span></span><br><span class="line"><span class="keyword">localparam</span> TIMER_CNT_1S = <span class="number">30&#x27;d100_000_000</span>-<span class="number">1&#x27;b1</span>;	<span class="comment">//1s计数的最大值	</span></span><br><span class="line"><span class="keyword">localparam</span> TIMER_CNT_10MS = <span class="number">30&#x27;d1_000_000</span>-<span class="number">1&#x27;b1</span>;	<span class="comment">//10ms计数的最大值</span></span><br><span class="line"><span class="meta">`<span class="keyword">endif</span> </span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="2-源代码-2"><a href="#2-源代码-2" class="headerlink" title="2.源代码"></a>2.源代码</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> BUFGCE_design(</span><br><span class="line">    clk,</span><br><span class="line">    rst_n,</span><br><span class="line">    outclk</span><br><span class="line">);</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> clk;</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> rst_n;</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">wire</span> outclk;</span><br><span class="line"></span><br><span class="line">    <span class="meta">`<span class="keyword">define</span> SIMULATION</span><span class="comment">//在真实情况下运行时，将此行注释掉就行</span></span><br><span class="line">    <span class="meta">`<span class="keyword">ifdef</span> SIMULATION</span></span><br><span class="line">    <span class="comment">//仿真情况下用较小的计数值代替，不然仿真时间过长</span></span><br><span class="line">    <span class="keyword">localparam</span> TIMER_CNT_1s = <span class="number">30&#x27;d1_000</span>-<span class="number">1&#x27;b1</span>;<span class="comment">//1s计数的最大值</span></span><br><span class="line">    <span class="keyword">localparam</span> TIMER_CNT_10ms=<span class="number">30&#x27;d1_0</span>-<span class="number">1&#x27;b1</span>;<span class="comment">//10ms计数的最大值 </span></span><br><span class="line">    <span class="meta">`<span class="keyword">else</span></span></span><br><span class="line">    <span class="keyword">localparam</span> TIMER_CNT_1S = <span class="number">30&#x27;d100_000_000</span>-<span class="number">1&#x27;b1</span>;	<span class="comment">//1s计数的最大值	</span></span><br><span class="line">    <span class="keyword">localparam</span> TIMER_CNT_10MS = <span class="number">30&#x27;d1_000_000</span>-<span class="number">1&#x27;b1</span>;	<span class="comment">//10ms计数的最大值</span></span><br><span class="line">    <span class="meta">`<span class="keyword">endif</span> </span></span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//中间变量</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">29</span>:<span class="number">0</span>] cnt;</span><br><span class="line">    <span class="keyword">reg</span> en_10ms;</span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//1s周期计数模块</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(!rst_n)</span><br><span class="line">            cnt&lt;=<span class="number">30&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(cnt&lt;TIMER_CNT_1s)</span><br><span class="line">            cnt&lt;=cnt+<span class="number">1&#x27;b1</span>;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            cnt&lt;=<span class="number">30&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//10ms使能信号产生</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(!rst_n)</span><br><span class="line">            en_10ms&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(cnt&lt;=TIMER_CNT_10ms)</span><br><span class="line">            en_10ms&lt;=<span class="number">1&#x27;b1</span>;  </span><br><span class="line">        <span class="keyword">else</span>    </span><br><span class="line">            en_10ms&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//例化BUFGCE原语</span></span><br><span class="line">    BUFGCE BUFGCE_inst (</span><br><span class="line">        <span class="variable">.O</span>(outclk),   <span class="comment">// 1-bit output: Clock output</span></span><br><span class="line">        <span class="variable">.CE</span>(en_10ms), <span class="comment">// 1-bit input: Clock enable input for I0</span></span><br><span class="line">        <span class="variable">.I</span>(clk)    <span class="comment">// 1-bit input: Primary clock</span></span><br><span class="line">   );</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="3-Testbench-2"><a href="#3-Testbench-2" class="headerlink" title="3.Testbench"></a>3.Testbench</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> CLK_PERIOD 10</span></span><br><span class="line"><span class="keyword">module</span> BUFGCE_design_tb;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> clk;</span><br><span class="line">    <span class="keyword">reg</span> rst_n;</span><br><span class="line">    <span class="keyword">wire</span> outclk;</span><br><span class="line"></span><br><span class="line">    BUFGCE_design BUFGCE_design_1(</span><br><span class="line">        <span class="variable">.clk</span>(clk),</span><br><span class="line">        <span class="variable">.rst_n</span>(rst_n),</span><br><span class="line">        <span class="variable">.outclk</span>(outclk)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">//时钟信号的产生</span></span><br><span class="line">    <span class="keyword">initial</span> clk=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">always</span> <span class="variable">#(`CLK_PERIOD/2)</span> clk=~clk;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        rst_n=<span class="number">0</span>;</span><br><span class="line">        #<span class="number">1000</span> rst_n=<span class="number">1</span>;</span><br><span class="line">        #<span class="number">3_000_000</span> <span class="built_in">$stop</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="4-仿真结果-2"><a href="#4-仿真结果-2" class="headerlink" title="4.仿真结果"></a>4.仿真结果</h2><p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230108234639688.png" alt="image-20230108234639688"></p>
<hr>
<h1 id="同步复位与异步复位"><a href="#同步复位与异步复位" class="headerlink" title="同步复位与异步复位"></a>同步复位与异步复位</h1><h2 id="1-关键点-3"><a href="#1-关键点-3" class="headerlink" title="1.关键点"></a>1.关键点</h2><ul>
<li>经过同步处理的异步复位信号与同步信号受到时钟控制会同时复位，异步信号会不受时钟控制立马复位</li>
<li>同步信号与异步信号同时退出复位，同步处理的异步信号会置后一个时钟周期后退出复位</li>
</ul>
<h2 id="2-源代码-3"><a href="#2-源代码-3" class="headerlink" title="2.源代码"></a>2.源代码</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> rst_signal_design(</span><br><span class="line">    i_clk,</span><br><span class="line">    i_rst_n,</span><br><span class="line">    i_data,</span><br><span class="line">    o_sync_data,</span><br><span class="line">    o_asyn_data,</span><br><span class="line">    o_asyn_data2<span class="comment">//经过同步处理的异步复位信号</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> i_clk;</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> i_rst_n;</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] i_data;</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] o_sync_data;</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] o_asyn_data;</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] o_asyn_data2;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//同步复位</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(!i_rst_n)</span><br><span class="line">            o_sync_data&lt;=<span class="number">4&#x27;d0</span>;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            o_sync_data&lt;=i_data;       </span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//异步复位</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk <span class="keyword">or</span> <span class="keyword">negedge</span> i_rst_n) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(!i_rst_n)</span><br><span class="line">            o_asyn_data=<span class="number">4&#x27;d0</span>;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            o_asyn_data&lt;=i_data;      </span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//对复位信号做同步处理，产生新的异步复位信号</span></span><br><span class="line">    <span class="keyword">reg</span> r_rst_n;</span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk)</span><br><span class="line">        r_rst_n&lt;=i_rst_n;</span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk <span class="keyword">or</span> <span class="keyword">negedge</span> r_rst_n) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(!r_rst_n)</span><br><span class="line">            o_asyn_data2&lt;=<span class="number">4&#x27;d0</span>;<span class="comment">//此信号将和同步复位同时做复位操作</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            o_asyn_data2&lt;=i_data;<span class="comment">//相比同步复位退出复位会延时一个时钟周期</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="3-Testbench-3"><a href="#3-Testbench-3" class="headerlink" title="3.Testbench"></a>3.Testbench</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> CLK_PERIOD 10</span></span><br><span class="line"><span class="keyword">module</span> rst_signal_design_tb;</span><br><span class="line">    <span class="keyword">reg</span> i_clk;</span><br><span class="line">    <span class="keyword">reg</span> i_rst_n;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] i_data;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] o_sync_data;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] o_asyn_data;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] o_asyn_data2;</span><br><span class="line"></span><br><span class="line">    rst_signal_design rst_signal_design_U1(</span><br><span class="line">        <span class="variable">.i_clk</span>(i_clk),</span><br><span class="line">        <span class="variable">.i_rst_n</span>(i_rst_n),</span><br><span class="line">        <span class="variable">.i_data</span>(i_data),</span><br><span class="line">        <span class="variable">.o_sync_data</span>(o_sync_data),</span><br><span class="line">        <span class="variable">.o_asyn_data</span>(o_asyn_data),</span><br><span class="line">        <span class="variable">.o_asyn_data2</span>(o_asyn_data2)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">//时钟信号的产生</span></span><br><span class="line">    <span class="keyword">initial</span> i_clk=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">always</span> <span class="variable">#(`CLK_PERIOD/2)</span> i_clk=~i_clk;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//复位信号的产生</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        i_rst_n=<span class="number">0</span>;</span><br><span class="line">        #<span class="number">1000</span> i_rst_n=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">repeat</span>(<span class="number">10</span>) <span class="keyword">begin</span> @(<span class="keyword">posedge</span> i_clk); <span class="keyword">end</span></span><br><span class="line">        #<span class="number">4</span> i_rst_n=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">repeat</span>(<span class="number">10</span>) <span class="keyword">begin</span> @(<span class="keyword">posedge</span> i_clk); <span class="keyword">end</span></span><br><span class="line">        i_rst_n=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//输入激励的产生</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        i_data&lt;=<span class="number">4&#x27;b1111</span>;</span><br><span class="line">        @(<span class="keyword">posedge</span> i_rst_n);<span class="comment">//等待复位完成</span></span><br><span class="line">        <span class="keyword">repeat</span>(<span class="number">30_000</span>) <span class="keyword">begin</span></span><br><span class="line">            @(<span class="keyword">posedge</span> i_clk);</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="built_in">$stop</span>;</span><br><span class="line">    <span class="keyword">end</span> </span><br><span class="line">    </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="4-仿真结果-3"><a href="#4-仿真结果-3" class="headerlink" title="4.仿真结果"></a>4.仿真结果</h2><p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230109104555400.png" alt="image-20230109104555400"></p>
<hr>
<h1 id="脉冲边沿检测"><a href="#脉冲边沿检测" class="headerlink" title="脉冲边沿检测"></a>脉冲边沿检测</h1><h2 id="1-关键点-4"><a href="#1-关键点-4" class="headerlink" title="1.关键点"></a>1.关键点</h2><ul>
<li>使用两级寄存器对输入脉冲进行缓存，低位寄存器保存的是最新输入数据，而高位寄存器保存的是低位寄存器的数据，故高位寄存器比低位寄存器慢一个时钟周期</li>
</ul>
<img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230109110344324.png" alt="image-20230109110344324" style="zoom: 33%;">

<ul>
<li><p>关键代码：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] r_pulse;<span class="comment">//两级寄存器</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!i_rst_n)</span><br><span class="line">        r_pulse&lt;=<span class="number">2&#x27;b00</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        r_pulse&lt;=&#123;r_pulse[<span class="number">0</span>],i_pulse&#125;;</span><br><span class="line">    <span class="comment">//上述代码等效为：</span></span><br><span class="line">    <span class="comment">//r_pulse[0]&lt;=i_pulse;</span></span><br><span class="line">    <span class="comment">//r_pulse[1]&lt;=r_pulse[0];</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="2-源代码-4"><a href="#2-源代码-4" class="headerlink" title="2.源代码"></a>2.源代码</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> edge_detection_design(</span><br><span class="line">    i_clk,</span><br><span class="line">    i_rst_n,</span><br><span class="line">    i_pulse,</span><br><span class="line">    o_rise_flag,</span><br><span class="line">    o_down_flag</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> i_clk;</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> i_rst_n;</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> i_pulse;</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">wire</span> o_rise_flag;</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">wire</span> o_down_flag;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] r_pulse;<span class="comment">//两级寄存器</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(!i_rst_n)</span><br><span class="line">            r_pulse&lt;=<span class="number">2&#x27;b00</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            r_pulse&lt;=&#123;r_pulse[<span class="number">0</span>],i_pulse&#125;;</span><br><span class="line">        <span class="comment">//上述代码等效为：</span></span><br><span class="line">        <span class="comment">//r_pulse[0]&lt;=i_pulse;</span></span><br><span class="line">        <span class="comment">//r_pulse[1]&lt;=r_pulse[0];</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//上升沿的判断</span></span><br><span class="line">    <span class="keyword">assign</span> o_rise_flag=r_pulse[<span class="number">0</span>]&amp;~r_pulse[<span class="number">1</span>];</span><br><span class="line">    <span class="comment">//下降沿的判断</span></span><br><span class="line">    <span class="keyword">assign</span> o_down_flag=~r_pulse[<span class="number">0</span>]&amp;r_pulse[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="3-Testbench-4"><a href="#3-Testbench-4" class="headerlink" title="3.Testbench"></a>3.Testbench</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> CLK_PERIOD 10</span></span><br><span class="line"><span class="keyword">module</span> edge_detection_design_tb;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> i_clk;</span><br><span class="line">    <span class="keyword">reg</span> i_rst_n;</span><br><span class="line">    <span class="keyword">reg</span> i_pulse;</span><br><span class="line">    <span class="keyword">wire</span> o_rise_flag;</span><br><span class="line">    <span class="keyword">wire</span> o_down_flag;</span><br><span class="line"></span><br><span class="line">    edge_detection_design edge_detection_design_U1(</span><br><span class="line">        <span class="variable">.i_clk</span>(i_clk),</span><br><span class="line">        <span class="variable">.i_rst_n</span>(i_rst_n),</span><br><span class="line">        <span class="variable">.i_pulse</span>(i_pulse),</span><br><span class="line">        <span class="variable">.o_rise_flag</span>(o_rise_flag), </span><br><span class="line">        <span class="variable">.o_down_flag</span>(o_down_flag) </span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">//时钟信号的产生</span></span><br><span class="line">    <span class="keyword">initial</span> i_clk=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">always</span> <span class="variable">#(`CLK_PERIOD/2)</span> i_clk=~i_clk;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//复位信号的产生</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        i_rst_n=<span class="number">0</span>;</span><br><span class="line">        #<span class="number">1000</span> i_rst_n=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//输入激励的产生</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        i_pulse&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line">        @(<span class="keyword">posedge</span> i_rst_n);<span class="comment">//等待复位完成</span></span><br><span class="line">    </span><br><span class="line">        <span class="keyword">repeat</span>(<span class="number">10</span>) <span class="keyword">begin</span></span><br><span class="line">            @(<span class="keyword">posedge</span> i_clk);</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        #<span class="number">4</span> i_pulse&lt;=<span class="number">1&#x27;b1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">repeat</span>(<span class="number">10</span>) <span class="keyword">begin</span></span><br><span class="line">            @(<span class="keyword">posedge</span> i_clk);</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        #<span class="number">4</span> i_pulse&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">repeat</span>(<span class="number">10</span>) <span class="keyword">begin</span></span><br><span class="line">            @(<span class="keyword">posedge</span> i_clk);</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">$stop</span>;</span><br><span class="line">    <span class="keyword">end</span> </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="4-仿真结果-4"><a href="#4-仿真结果-4" class="headerlink" title="4.仿真结果"></a>4.仿真结果</h2><p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230109112028556.png" alt="image-20230109112028556"></p>
<hr>
<h1 id="脉冲计数器"><a href="#脉冲计数器" class="headerlink" title="脉冲计数器"></a>脉冲计数器</h1><ul>
<li>在使能信号高电平进行计数，在低电平对计数清零</li>
</ul>
<h2 id="1-源代码"><a href="#1-源代码" class="headerlink" title="1.源代码"></a>1.源代码</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> pulse_counter_design(</span><br><span class="line">    i_clk,</span><br><span class="line">    i_rst_n,</span><br><span class="line">    i_pulse,</span><br><span class="line">    i_en,</span><br><span class="line">    o_pulse_cnt</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> i_clk;</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> i_rst_n;</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> i_pulse;</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> i_en;</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cnt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] r_pulse;</span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(!i_rst_n)</span><br><span class="line">            r_pulse&lt;=<span class="number">2&#x27;b00</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            r_pulse=&#123;r_pulse[<span class="number">0</span>],i_pulse&#125;;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//上升沿检测</span></span><br><span class="line">    <span class="keyword">wire</span> w_rise_edge;</span><br><span class="line">    <span class="keyword">assign</span> w_rise_edge=r_pulse[<span class="number">0</span>]&amp;~r_pulse[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(i_en) <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span>(w_rise_edge)</span><br><span class="line">                o_pulse_cnt&lt;=o_pulse_cnt+<span class="number">1&#x27;b1</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                o_pulse_cnt&lt;=o_pulse_cnt;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            o_pulse_cnt&lt;=<span class="number">16&#x27;d0</span>;</span><br><span class="line">    <span class="keyword">end</span>     </span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="2-Testbench"><a href="#2-Testbench" class="headerlink" title="2.Testbench"></a>2.Testbench</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> CLK_PERIOD 10</span></span><br><span class="line"><span class="keyword">module</span> pulse_counter_tb;</span><br><span class="line">    <span class="keyword">reg</span> i_clk;</span><br><span class="line">    <span class="keyword">reg</span> i_rst_n;</span><br><span class="line">    <span class="keyword">reg</span> i_pulse;</span><br><span class="line">    <span class="keyword">reg</span> i_en;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cnt;</span><br><span class="line"></span><br><span class="line">    pulse_counter_design pulse_counter_design_U1(</span><br><span class="line">        <span class="variable">.i_clk</span>(i_clk),</span><br><span class="line">        <span class="variable">.i_rst_n</span>(i_rst_n),</span><br><span class="line">        <span class="variable">.i_pulse</span>(i_pulse),</span><br><span class="line">        <span class="variable">.i_en</span>(i_en), </span><br><span class="line">        <span class="variable">.o_pulse_cnt</span>(o_pulse_cnt) </span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">//时钟信号的产生</span></span><br><span class="line">    <span class="keyword">initial</span> i_clk=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">always</span> <span class="variable">#(`CLK_PERIOD/2)</span> i_clk=~i_clk;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//复位信号的产生</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        i_rst_n=<span class="number">0</span>;</span><br><span class="line">        #<span class="number">1000</span> i_rst_n=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">integer</span> i;</span><br><span class="line">    <span class="comment">//输入激励的产生</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        i_pulse&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line">        i_en&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line">        @(<span class="keyword">posedge</span> i_rst_n);<span class="comment">//等待复位完成</span></span><br><span class="line">    </span><br><span class="line">        <span class="keyword">repeat</span>(<span class="number">10</span>) <span class="keyword">begin</span></span><br><span class="line">            @(<span class="keyword">posedge</span> i_clk);</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        #<span class="number">4</span> i_en&lt;=<span class="number">1&#x27;b1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//i_pulse激励的产生</span></span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">50</span>;i=i+<span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">            #<span class="number">500</span> i_pulse&lt;=<span class="number">1&#x27;b1</span>;</span><br><span class="line">            #<span class="number">300</span> i_pulse&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        i_en&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line">        #<span class="number">10_000</span>;</span><br><span class="line"></span><br><span class="line">        i_en&lt;=<span class="number">1&#x27;b1</span>;</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">69</span>;i=i+<span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">            #<span class="number">500</span> i_pulse&lt;=<span class="number">1&#x27;b1</span>;</span><br><span class="line">            #<span class="number">300</span> i_pulse&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        i_en&lt;=<span class="number">1&#x27;b0</span>;  </span><br><span class="line">        #<span class="number">10_000</span>; </span><br><span class="line"></span><br><span class="line">        i_en&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">15</span>;i=i+<span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">            #<span class="number">500</span> i_pulse&lt;=<span class="number">1&#x27;b1</span>;</span><br><span class="line">            #<span class="number">300</span> i_pulse&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        i_en&lt;=<span class="number">1&#x27;b0</span>;  </span><br><span class="line">        #<span class="number">10_000</span>; </span><br><span class="line"></span><br><span class="line">        <span class="built_in">$stop</span>;</span><br><span class="line">    <span class="keyword">end</span> </span><br><span class="line">    </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="3-仿真结果"><a href="#3-仿真结果" class="headerlink" title="3.仿真结果"></a>3.仿真结果</h2><p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230109113345645.png" alt="image-20230109113345645"></p>
<hr>
<h1 id="generate语法的使用"><a href="#generate语法的使用" class="headerlink" title="generate语法的使用"></a>generate语法的使用</h1><ul>
<li><p>设计一个脉冲计数器，功能如下：</p>
</li>
<li><p>输入脉冲：16路脉冲信号，分别对每路进行脉冲检测并计数</p>
</li>
<li><p>使能信号：高电平进行计数，低电平清零计数器</p>
</li>
</ul>
<h2 id="1-关键点-5"><a href="#1-关键点-5" class="headerlink" title="1.关键点"></a>1.关键点</h2><ul>
<li>generate语法有generate for、generate if和generate case三种，可以在generate中使用的语法语句包括module、UDP（用户自定义原语）、门级原语、连续赋值语句assign、always语句和initial语句等</li>
<li>定义genvar作为generate我的循环变量</li>
<li>随机数的产生：<code>&#123;$random&#125;%65536;</code>//产生0~65535的随机数，若不加括号，即为<code>$random%65536</code>，则产生-65535-+65535之间的随机数</li>
</ul>
<h2 id="2-源代码-5"><a href="#2-源代码-5" class="headerlink" title="2.源代码"></a>2.源代码</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> generate_for_design(</span><br><span class="line">    i_clk,</span><br><span class="line">    i_rst_n,</span><br><span class="line">    i_pulse,</span><br><span class="line">    i_en,</span><br><span class="line">    o_pulse_cnt0,</span><br><span class="line">    o_pulse_cnt1,</span><br><span class="line">    o_pulse_cnt2,</span><br><span class="line">    o_pulse_cnt3,</span><br><span class="line">    o_pulse_cnt4,</span><br><span class="line">    o_pulse_cnt5,</span><br><span class="line">    o_pulse_cnt6,</span><br><span class="line">    o_pulse_cnt7,</span><br><span class="line">    o_pulse_cnt8,</span><br><span class="line">    o_pulse_cnt9,</span><br><span class="line">    o_pulse_cnta,</span><br><span class="line">    o_pulse_cntb,</span><br><span class="line">    o_pulse_cntc,</span><br><span class="line">    o_pulse_cntd,</span><br><span class="line">    o_pulse_cnte,</span><br><span class="line">    o_pulse_cntf</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> i_clk;</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> i_rst_n;</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] i_pulse;</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> i_en;</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cnt0;</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cnt1;</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cnt2;</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cnt3;</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cnt4;</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cnt5;</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cnt6;</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cnt7;</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cnt8;</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cnt9;</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cnta;</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cntb;</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cntc;</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cntd;</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cnte;</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cntf;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//二维数组：16个16位宽的计数器</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] r_pulse_cnt[<span class="number">15</span>:<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//genvar for模块</span></span><br><span class="line">    <span class="keyword">genvar</span> i; </span><br><span class="line">    <span class="keyword">generate</span></span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">16</span>;i=i+<span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">            pulse_counter_design pulse_counter_design_U(</span><br><span class="line">                <span class="variable">.i_clk</span>(i_clk),</span><br><span class="line">                <span class="variable">.i_rst_n</span>(i_rst_n),</span><br><span class="line">                <span class="variable">.i_pulse</span>(i_pulse[i]),</span><br><span class="line">                <span class="variable">.i_en</span>(i_en), </span><br><span class="line">                <span class="variable">.o_pulse_cnt</span>(r_pulse_cnt[i]) </span><br><span class="line">            );</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">endgenerate</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> o_pulse_cnt0=r_pulse_cnt[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">assign</span> o_pulse_cnt1=r_pulse_cnt[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">assign</span> o_pulse_cnt2=r_pulse_cnt[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">assign</span> o_pulse_cnt3=r_pulse_cnt[<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">assign</span> o_pulse_cnt4=r_pulse_cnt[<span class="number">4</span>];</span><br><span class="line">    <span class="keyword">assign</span> o_pulse_cnt5=r_pulse_cnt[<span class="number">5</span>];</span><br><span class="line">    <span class="keyword">assign</span> o_pulse_cnt6=r_pulse_cnt[<span class="number">6</span>];</span><br><span class="line">    <span class="keyword">assign</span> o_pulse_cnt7=r_pulse_cnt[<span class="number">7</span>];</span><br><span class="line">    <span class="keyword">assign</span> o_pulse_cnt8=r_pulse_cnt[<span class="number">8</span>];</span><br><span class="line">    <span class="keyword">assign</span> o_pulse_cnt9=r_pulse_cnt[<span class="number">9</span>];</span><br><span class="line">    <span class="keyword">assign</span> o_pulse_cnta=r_pulse_cnt[<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">assign</span> o_pulse_cntb=r_pulse_cnt[<span class="number">11</span>];</span><br><span class="line">    <span class="keyword">assign</span> o_pulse_cntc=r_pulse_cnt[<span class="number">12</span>];</span><br><span class="line">    <span class="keyword">assign</span> o_pulse_cntd=r_pulse_cnt[<span class="number">13</span>];</span><br><span class="line">    <span class="keyword">assign</span> o_pulse_cnte=r_pulse_cnt[<span class="number">14</span>];</span><br><span class="line">    <span class="keyword">assign</span> o_pulse_cntf=r_pulse_cnt[<span class="number">15</span>];</span><br><span class="line">    </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="3-Testbench-5"><a href="#3-Testbench-5" class="headerlink" title="3.Testbench"></a>3.Testbench</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> CLK_PERIOD 10</span></span><br><span class="line"><span class="keyword">module</span> generate_for_tb;</span><br><span class="line">    <span class="keyword">reg</span> i_clk;</span><br><span class="line">    <span class="keyword">reg</span> i_rst_n;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">15</span>:<span class="number">0</span>] i_pulse;</span><br><span class="line">    <span class="keyword">reg</span> i_en;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cnt0;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cnt1;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cnt2;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cnt3;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cnt4;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cnt5;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cnt6;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cnt7;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cnt8;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cnt9;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cnta;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cntb;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cntc;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cntd;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cnte;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cntf;</span><br><span class="line"></span><br><span class="line">    generate_for_design generate_for_design(</span><br><span class="line">        <span class="variable">.i_clk</span>(i_clk),</span><br><span class="line">        <span class="variable">.i_rst_n</span>(i_rst_n),</span><br><span class="line">        <span class="variable">.i_pulse</span>(i_pulse),</span><br><span class="line">        <span class="variable">.i_en</span>(i_en), </span><br><span class="line">        <span class="variable">.o_pulse_cnt0</span>(o_pulse_cnt0),</span><br><span class="line">        <span class="variable">.o_pulse_cnt1</span>(o_pulse_cnt1),</span><br><span class="line">        <span class="variable">.o_pulse_cnt2</span>(o_pulse_cnt2),</span><br><span class="line">        <span class="variable">.o_pulse_cnt3</span>(o_pulse_cnt3),</span><br><span class="line">        <span class="variable">.o_pulse_cnt4</span>(o_pulse_cnt4),</span><br><span class="line">        <span class="variable">.o_pulse_cnt5</span>(o_pulse_cnt5),</span><br><span class="line">        <span class="variable">.o_pulse_cnt6</span>(o_pulse_cnt6),</span><br><span class="line">        <span class="variable">.o_pulse_cnt7</span>(o_pulse_cnt7),</span><br><span class="line">        <span class="variable">.o_pulse_cnt8</span>(o_pulse_cnt8),</span><br><span class="line">        <span class="variable">.o_pulse_cnt9</span>(o_pulse_cnt9),</span><br><span class="line">        <span class="variable">.o_pulse_cnta</span>(o_pulse_cnta),</span><br><span class="line">        <span class="variable">.o_pulse_cntb</span>(o_pulse_cntb),</span><br><span class="line">        <span class="variable">.o_pulse_cntc</span>(o_pulse_cntc),</span><br><span class="line">        <span class="variable">.o_pulse_cntd</span>(o_pulse_cntd),</span><br><span class="line">        <span class="variable">.o_pulse_cnte</span>(o_pulse_cnte),</span><br><span class="line">        <span class="variable">.o_pulse_cntf</span>(o_pulse_cntf)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">//时钟信号的产生</span></span><br><span class="line">    <span class="keyword">initial</span> i_clk=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">always</span> <span class="variable">#(`CLK_PERIOD/2)</span> i_clk=~i_clk;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//复位信号的产生</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        i_rst_n=<span class="number">0</span>;</span><br><span class="line">        #<span class="number">1000</span> i_rst_n=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">integer</span> i;</span><br><span class="line">    <span class="comment">//输入激励的产生</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        i_pulse&lt;=<span class="number">16&#x27;b0</span>;</span><br><span class="line">        i_en&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line">        @(<span class="keyword">posedge</span> i_rst_n);<span class="comment">//等待复位完成</span></span><br><span class="line">    </span><br><span class="line">        <span class="keyword">repeat</span>(<span class="number">10</span>) <span class="keyword">begin</span></span><br><span class="line">            @(<span class="keyword">posedge</span> i_clk);</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        #<span class="number">4</span> i_en&lt;=<span class="number">1&#x27;b1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//i_pulse激励的产生</span></span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">50</span>;i=i+<span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">            #<span class="number">500</span> i_pulse&lt;=&#123;<span class="built_in">$random</span>&#125;%<span class="number">65536</span>;<span class="comment">//产生0~65535的随机数</span></span><br><span class="line">            #<span class="number">300</span> i_pulse&lt;=<span class="number">16&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        i_en&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line">        #<span class="number">10_000</span>;</span><br><span class="line"></span><br><span class="line">        i_en&lt;=<span class="number">1&#x27;b1</span>;</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">69</span>;i=i+<span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">            #<span class="number">500</span> i_pulse&lt;=&#123;<span class="built_in">$random</span>&#125;%<span class="number">65536</span>;</span><br><span class="line">            #<span class="number">300</span> i_pulse&lt;=<span class="number">16&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        i_en&lt;=<span class="number">1&#x27;b0</span>;  </span><br><span class="line">        #<span class="number">10_000</span>; </span><br><span class="line"></span><br><span class="line">        i_en&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">15</span>;i=i+<span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">            #<span class="number">500</span> i_pulse&lt;=&#123;<span class="built_in">$random</span>&#125;%<span class="number">65536</span>;</span><br><span class="line">            #<span class="number">300</span> i_pulse&lt;=<span class="number">16&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        i_en&lt;=<span class="number">1&#x27;b0</span>;  </span><br><span class="line">        #<span class="number">10_000</span>; </span><br><span class="line"></span><br><span class="line">        <span class="built_in">$stop</span>;</span><br><span class="line">    <span class="keyword">end</span> </span><br><span class="line">    </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="4-仿真结果-5"><a href="#4-仿真结果-5" class="headerlink" title="4.仿真结果"></a>4.仿真结果</h2><p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230109122519817.png" alt="image-20230109122519817"></p>
<hr>
<h1 id="频率计数器"><a href="#频率计数器" class="headerlink" title="频率计数器"></a>频率计数器</h1><ul>
<li>在使能信号控制下，计算输入脉冲的每两个上升沿之间的时钟周期数并输出，即输出脉冲频率的计数值</li>
</ul>
<h2 id="1-关键点-6"><a href="#1-关键点-6" class="headerlink" title="1.关键点"></a>1.关键点</h2><ul>
<li><p>遇到上升沿检测标志就读取脉冲数</p>
</li>
<li><p>但是要滤除第一个上升沿检测标志，因为这时候刚刚使能，读取的第一个上升沿并不是两个上升沿之间的读数，滤除方式如下：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//////////////////////////////////////////</span></span><br><span class="line"><span class="comment">//输出信号产生：需要滤除第一个w_rise_edge脉冲信号</span></span><br><span class="line"><span class="keyword">reg</span> r_flag;</span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk)	<span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">if</span>(!i_rst_n) </span><br><span class="line">		r_flag &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(!i_en) </span><br><span class="line">		r_flag &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(w_rise_edge) </span><br><span class="line">		r_flag &lt;= <span class="number">&#x27;b1</span>;</span><br><span class="line">	<span class="keyword">else</span> </span><br><span class="line">		r_flag&lt;=r_flag;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> o_vld = w_rise_edge &amp; r_flag;</span><br></pre></td></tr></table></figure>
</li>
<li><p>因为计数值是从0开始计数，故输出计数值时需要加1</p>
</li>
</ul>
<h2 id="2-源代码-6"><a href="#2-源代码-6" class="headerlink" title="2.源代码"></a>2.源代码</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> frequency_counter_design(</span><br><span class="line">	i_clk,</span><br><span class="line">	i_rst_n,</span><br><span class="line">	i_pulse,</span><br><span class="line">	i_en,</span><br><span class="line">	o_vld,</span><br><span class="line">	o_pulse_cnt</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> i_clk;</span><br><span class="line">	<span class="keyword">input</span> <span class="keyword">wire</span> i_rst_n;</span><br><span class="line">	<span class="keyword">input</span> <span class="keyword">wire</span> i_pulse;</span><br><span class="line">	<span class="keyword">input</span> <span class="keyword">wire</span> i_en;</span><br><span class="line">	<span class="keyword">output</span> <span class="keyword">wire</span> o_vld;</span><br><span class="line">	<span class="keyword">output</span> <span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] o_pulse_cnt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span>[<span class="number">1</span>:<span class="number">0</span>] r_pulse;</span><br><span class="line">    <span class="keyword">wire</span> w_rise_edge;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//脉冲边沿检测逻辑</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk)	</span><br><span class="line">    	<span class="keyword">if</span>(!i_rst_n) r_pulse &lt;= <span class="number">2&#x27;b00</span>;</span><br><span class="line">    	<span class="keyword">else</span> r_pulse &lt;= &#123;r_pulse[<span class="number">0</span>],i_pulse&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> w_rise_edge = r_pulse[<span class="number">0</span>] &amp; ~r_pulse[<span class="number">1</span>];	</span><br><span class="line"></span><br><span class="line">    <span class="comment">//////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//输出信号产生：需要滤除第一个w_rise_edge脉冲信号</span></span><br><span class="line">    <span class="keyword">reg</span> r_flag;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk)	<span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">if</span>(!i_rst_n) </span><br><span class="line">			r_flag &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">else</span> <span class="keyword">if</span>(!i_en) </span><br><span class="line">			r_flag &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">else</span> <span class="keyword">if</span>(w_rise_edge) </span><br><span class="line">			r_flag &lt;= <span class="number">&#x27;b1</span>;</span><br><span class="line">    	<span class="keyword">else</span> </span><br><span class="line">			r_flag&lt;=r_flag;</span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> o_vld = w_rise_edge &amp; r_flag;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//脉冲计数逻辑</span></span><br><span class="line">    <span class="keyword">reg</span>[<span class="number">15</span>:<span class="number">0</span>] r_pulse_cnt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk)	<span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">if</span>(!i_en) </span><br><span class="line">			r_pulse_cnt &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">else</span> <span class="keyword">if</span>(w_rise_edge) </span><br><span class="line">			r_pulse_cnt &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">else</span> </span><br><span class="line">			r_pulse_cnt &lt;= r_pulse_cnt+<span class="number">1&#x27;b1</span>;</span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> o_pulse_cnt = r_pulse_cnt+<span class="number">1&#x27;b1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="3-Testbench-6"><a href="#3-Testbench-6" class="headerlink" title="3.Testbench"></a>3.Testbench</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> CLK_PERIORD		10		</span><span class="comment">//时钟周期设置为10ns（100MHz）	</span></span><br><span class="line"><span class="keyword">module</span> frequency_counter_tb;</span><br><span class="line">    <span class="comment">////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//接口申明</span></span><br><span class="line">    <span class="keyword">reg</span> clk;</span><br><span class="line">    <span class="keyword">reg</span> rst_n;</span><br><span class="line">    <span class="keyword">reg</span> i_pulse;</span><br><span class="line">    <span class="keyword">reg</span> i_en;</span><br><span class="line">    <span class="keyword">wire</span> o_vld;</span><br><span class="line">    <span class="keyword">wire</span>[<span class="number">15</span>:<span class="number">0</span>] o_pulse_cnt;</span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////////////////////////////	</span></span><br><span class="line">    <span class="comment">//对被测试的设计进行例化</span></span><br><span class="line">    frequency_counter_design frequency_counter_design_U1(</span><br><span class="line">    	<span class="variable">.i_clk</span>(clk),</span><br><span class="line">    	<span class="variable">.i_rst_n</span>(rst_n),</span><br><span class="line">    	<span class="variable">.i_pulse</span>(i_pulse),</span><br><span class="line">    	<span class="variable">.i_en</span>(i_en),</span><br><span class="line">    	<span class="variable">.o_vld</span>(o_vld),</span><br><span class="line">    	<span class="variable">.o_pulse_cnt</span>(o_pulse_cnt)</span><br><span class="line">        );	</span><br><span class="line">    </span><br><span class="line">    <span class="comment">////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//复位和时钟产生</span></span><br><span class="line">    <span class="comment">//时钟和复位初始化、复位产生</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">    	clk &lt;= <span class="number">0</span>;</span><br><span class="line">    	rst_n &lt;= <span class="number">0</span>;</span><br><span class="line">    	#<span class="number">1000</span>;</span><br><span class="line">    	rst_n &lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//时钟产生</span></span><br><span class="line">    <span class="keyword">always</span> <span class="variable">#(`CLK_PERIORD/2)</span> clk = ~clk;	</span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//测试激励产生</span></span><br><span class="line">    <span class="keyword">integer</span> i;</span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">    	i_pulse &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">    	i_en &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">    	@(<span class="keyword">posedge</span> rst_n);	<span class="comment">//等待复位完成</span></span><br><span class="line">    </span><br><span class="line">    	@(<span class="keyword">posedge</span> clk);</span><br><span class="line">    	<span class="keyword">repeat</span>(<span class="number">10</span>) <span class="keyword">begin</span></span><br><span class="line">    		@(<span class="keyword">posedge</span> clk);</span><br><span class="line">    	<span class="keyword">end</span></span><br><span class="line">    	#<span class="number">4</span>;</span><br><span class="line">    </span><br><span class="line">    	i_en &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">    	<span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">50</span>; i=i+<span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">    		#<span class="number">1000</span>;</span><br><span class="line">    		i_pulse &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">    		#<span class="number">1000</span>;</span><br><span class="line">    		i_pulse &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">end</span></span><br><span class="line">    	i_en &lt;= <span class="number">1&#x27;b0</span>;	</span><br><span class="line">    	#<span class="number">10_000</span>;</span><br><span class="line">    </span><br><span class="line">    	i_en &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">    	<span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">69</span>; i=i+<span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">    		#<span class="number">5000</span>;</span><br><span class="line">    		i_pulse &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">    		#<span class="number">5000</span>;</span><br><span class="line">    		i_pulse &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">end</span></span><br><span class="line">    	i_en &lt;= <span class="number">1&#x27;b0</span>;	</span><br><span class="line">    	#<span class="number">10_000</span>;	</span><br><span class="line">    </span><br><span class="line">    	i_en &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">15</span>; i=i+<span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">    		#<span class="number">500</span>;</span><br><span class="line">    		i_pulse &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">    		#<span class="number">300</span>;</span><br><span class="line">    		i_pulse &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">end</span></span><br><span class="line">    	i_en &lt;= <span class="number">1&#x27;b0</span>;	</span><br><span class="line">    	#<span class="number">10_000</span>;</span><br><span class="line">    	<span class="built_in">$stop</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="4-仿真结果-6"><a href="#4-仿真结果-6" class="headerlink" title="4.仿真结果"></a>4.仿真结果</h2><p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230109194755161.png" alt="image-20230109194755161"></p>
<p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230109194540797.png" alt="image-20230109194540797"></p>
<p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230109194734655.png" alt="image-20230109194734655"></p>
<hr>
<h1 id="4位格雷码计数器"><a href="#4位格雷码计数器" class="headerlink" title="4位格雷码计数器"></a>4位格雷码计数器</h1><h2 id="1-关键点-7"><a href="#1-关键点-7" class="headerlink" title="1.关键点"></a>1.关键点</h2><ul>
<li>系统显示任务<code>$display</code>和<code>$write</code><ul>
<li><code>$display</code>在一次输出后自动换行，而<code>$write</code>则不会</li>
<li>默认情况下，输出显示的数值所占字符个数由输出信号的数值类型和位宽决定。</li>
<li>用十进制显示时，高位的0会默认以空格填充，而用其他进制显示时，高位的0会显示出来。</li>
<li>在“%”和格式字符之间可以添加数字0，可以隐藏前置的0或空格，使得第一个非0数字顶格显示</li>
</ul>
</li>
<li>监视任务<code>$monitor</code><ul>
<li>当监视的信号发射变化时，会打印当前的值，通常与时间戳<code>$time</code>配合使用</li>
<li><code>$monitoroff</code>关闭监视</li>
<li><code>$monitoron</code>打开监视</li>
</ul>
</li>
<li>在always语句块中使用case语句描述组合逻辑，再使用assign将r_gray赋值给o_gray</li>
</ul>
<h2 id="2-源代码-7"><a href="#2-源代码-7" class="headerlink" title="2.源代码"></a>2.源代码</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> gray_counter_design(</span><br><span class="line">    i_clk,<span class="comment">//50MHz的输入时钟</span></span><br><span class="line">    i_rst_n,</span><br><span class="line">    o_gray</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> i_clk;</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> i_rst_n;</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] o_gray;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">localparam</span> TIMER_1S_MAX_CNT = <span class="number">32&#x27;d1_000_000_000</span>/<span class="number">20</span>;</span><br><span class="line">    <span class="comment">//////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//1s计数模块</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] cnt_1s;</span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(!i_rst_n)</span><br><span class="line">            cnt_1s&lt;=<span class="number">32&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(cnt_1s&lt;(TIMER_1S_MAX_CNT-<span class="number">1</span>))</span><br><span class="line">            cnt_1s&lt;=cnt_1s+<span class="number">32&#x27;b1</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            cnt_1s&lt;=<span class="number">32&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//计数器递增模块</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] counter;</span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(!i_rst_n)</span><br><span class="line">            counter&lt;=<span class="number">4&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(cnt_1s==(TIMER_1S_MAX_CNT-<span class="number">1</span>))</span><br><span class="line">            counter&lt;=counter+<span class="number">4&#x27;b1</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            counter&lt;=counter;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//将counter变成格雷码的形式</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] r_gray;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(!i_rst_n) </span><br><span class="line">            r_gray&lt;=<span class="number">4&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">case</span>(counter)</span><br><span class="line">                <span class="number">4&#x27;b0000</span>:r_gray&lt;=<span class="number">4&#x27;b0000</span>;</span><br><span class="line">                <span class="number">4&#x27;b0001</span>:r_gray&lt;=<span class="number">4&#x27;b0001</span>;</span><br><span class="line">                <span class="number">4&#x27;b0010</span>:r_gray&lt;=<span class="number">4&#x27;b0011</span>;</span><br><span class="line">                <span class="number">4&#x27;b0011</span>:r_gray&lt;=<span class="number">4&#x27;b0010</span>;</span><br><span class="line">                <span class="number">4&#x27;b0100</span>:r_gray&lt;=<span class="number">4&#x27;b0110</span>;</span><br><span class="line">                <span class="number">4&#x27;b0101</span>:r_gray&lt;=<span class="number">4&#x27;b0111</span>;</span><br><span class="line">                <span class="number">4&#x27;b0110</span>:r_gray&lt;=<span class="number">4&#x27;b0101</span>;</span><br><span class="line">                <span class="number">4&#x27;b0111</span>:r_gray&lt;=<span class="number">4&#x27;b0100</span>;</span><br><span class="line">                <span class="number">4&#x27;b1000</span>:r_gray&lt;=<span class="number">4&#x27;b1100</span>;</span><br><span class="line">                <span class="number">4&#x27;b1001</span>:r_gray&lt;=<span class="number">4&#x27;b1101</span>;</span><br><span class="line">                <span class="number">4&#x27;b1010</span>:r_gray&lt;=<span class="number">4&#x27;b1111</span>;</span><br><span class="line">                <span class="number">4&#x27;b1011</span>:r_gray&lt;=<span class="number">4&#x27;b1110</span>;</span><br><span class="line">                <span class="number">4&#x27;b1100</span>:r_gray&lt;=<span class="number">4&#x27;b1010</span>;</span><br><span class="line">                <span class="number">4&#x27;b1101</span>:r_gray&lt;=<span class="number">4&#x27;b1011</span>;</span><br><span class="line">                <span class="number">4&#x27;b1110</span>:r_gray&lt;=<span class="number">4&#x27;b1001</span>;</span><br><span class="line">                <span class="number">4&#x27;b1111</span>:r_gray&lt;=<span class="number">4&#x27;b1000</span>;</span><br><span class="line">                <span class="keyword">default</span>:;</span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> o_gray=r_gray;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="3-Testbench-7"><a href="#3-Testbench-7" class="headerlink" title="3.Testbench"></a>3.Testbench</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> CLK_PERIOD 20</span></span><br><span class="line"><span class="keyword">module</span> gray_counter_tb;</span><br><span class="line">    <span class="keyword">reg</span> i_clk;</span><br><span class="line">    <span class="keyword">reg</span> i_rst_n;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] o_gray;</span><br><span class="line"></span><br><span class="line">    gray_counter_design gray_counter_design_U1(</span><br><span class="line">        <span class="variable">.i_clk</span>(i_clk),</span><br><span class="line">        <span class="variable">.i_rst_n</span>(i_rst_n),</span><br><span class="line">        <span class="variable">.o_gray</span>(o_gray)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">//时钟信号的产生</span></span><br><span class="line">    <span class="keyword">initial</span> i_clk=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">always</span> <span class="variable">#(`CLK_PERIOD/2)</span> i_clk=~i_clk;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//复位信号的产生</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        i_rst_n=<span class="number">0</span>;</span><br><span class="line">        #<span class="number">1000</span> i_rst_n=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//输入激励的产生</span></span><br><span class="line">    <span class="keyword">integer</span> i;</span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        @(<span class="keyword">posedge</span> i_rst_n);<span class="comment">//等待复位完成</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">$monitor</span>(<span class="string">&quot;o_gray is %b at %0dns&quot;</span>,o_gray,<span class="built_in">$time</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">$stop</span>;</span><br><span class="line">    <span class="keyword">end</span> </span><br><span class="line">    </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="4-仿真结果-7"><a href="#4-仿真结果-7" class="headerlink" title="4.仿真结果"></a>4.仿真结果</h2><p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230203164007128.png" alt="image-20230203164007128"></p>
<hr>
<h1 id="基于查找表的8位格雷码转换"><a href="#基于查找表的8位格雷码转换" class="headerlink" title="基于查找表的8位格雷码转换"></a>基于查找表的8位格雷码转换</h1><h2 id="1-关键点-8"><a href="#1-关键点-8" class="headerlink" title="1.关键点"></a>1.关键点</h2><ul>
<li><p>查找表</p>
<ul>
<li>查找表简单说就是一个预先存储好结果的数据表</li>
<li>通过访问这张预先存储好结果的数据表，可以快速的获取不同输入的输出结果</li>
</ul>
</li>
<li><p>ROM初始化COE文件制作</p>
<p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230203165642299.png" alt="image-20230203165642299"></p>
<img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230203165922892.png" alt="image-20230203165922892" style="zoom: 50%;">

<img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230203170228814.png" alt="image-20230203170228814" style="zoom: 50%;">

<img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230203170655478.png" alt="image-20230203170655478" style="zoom: 50%;">

<img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230203170929138.png" alt="image-20230203170929138" style="zoom: 50%;">

<img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230203171454609.png" alt="image-20230203171454609" style="zoom:50%;">

<img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230203171705965.png" alt="image-20230203171705965" style="zoom: 67%;">

<img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230203172000521.png" alt="image-20230203172000521" style="zoom:50%;">
</li>
<li><p><strong>打拍操作</strong>：其类似脉冲边沿检测</p>
<p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230203174713842.png" alt="image-20230203174713842"></p>
</li>
</ul>
<h2 id="2-源代码-8"><a href="#2-源代码-8" class="headerlink" title="2.源代码"></a>2.源代码</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> gray8b_based_LUT_design(</span><br><span class="line">    i_clk,</span><br><span class="line">    i_rst_n,</span><br><span class="line">    i_en,</span><br><span class="line">    i_data,</span><br><span class="line">    o_vld,</span><br><span class="line">    o_gray</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> i_clk;</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> i_en;</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] i_data;</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> i_rst_n;</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">wire</span> o_vld;</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] o_gray;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//打两拍操作</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] r_vld;</span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(!i_rst_n)</span><br><span class="line">            r_vld&lt;=<span class="number">2&#x27;b00</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            r_vld&lt;=&#123;r_vld[<span class="number">0</span>],i_en&#125;;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> o_vld=r_vld[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    blk_mem_gen_0 blk_mem_gen_0_U (</span><br><span class="line">        <span class="variable">.clka</span>(i_clk),    <span class="comment">// input wire clka</span></span><br><span class="line">        <span class="variable">.addra</span>(i_data),  <span class="comment">// input wire [7 : 0] addra</span></span><br><span class="line">        <span class="variable">.douta</span>(o_gray)  <span class="comment">// output wire [7 : 0] douta</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="3-Testbench-8"><a href="#3-Testbench-8" class="headerlink" title="3.Testbench"></a>3.Testbench</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> CLK_PERIOD 20</span></span><br><span class="line"><span class="keyword">module</span> grab8b_based_LUT_tb;</span><br><span class="line">    <span class="keyword">reg</span> i_clk;</span><br><span class="line">    <span class="keyword">reg</span> i_en;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] i_data;</span><br><span class="line">    <span class="keyword">reg</span> i_rst_n;</span><br><span class="line">    <span class="keyword">wire</span> o_vld;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] o_gray;</span><br><span class="line"></span><br><span class="line">    gray8b_based_LUT_design gray8b_based_LUT_design_U1(</span><br><span class="line">        <span class="variable">.i_clk</span>(i_clk),</span><br><span class="line">        <span class="variable">.i_rst_n</span>(i_rst_n),</span><br><span class="line">        <span class="variable">.i_en</span>(i_en),</span><br><span class="line">        <span class="variable">.i_data</span>(i_data),</span><br><span class="line">        <span class="variable">.o_vld</span>(o_vld),</span><br><span class="line">        <span class="variable">.o_gray</span>(o_gray)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">//时钟信号的产生</span></span><br><span class="line">    <span class="keyword">initial</span> i_clk&lt;=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">always</span> <span class="variable">#(`CLK_PERIOD/2)</span> i_clk&lt;=~i_clk;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//复位信号的产生</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        i_rst_n&lt;=<span class="number">0</span>;</span><br><span class="line">        #<span class="number">1000</span> i_rst_n&lt;=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//输入激励的产生</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        i_en&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line">        i_data&lt;=<span class="number">8&#x27;b0</span>;</span><br><span class="line">        @(<span class="keyword">posedge</span> i_rst_n);<span class="comment">//等待复位完成</span></span><br><span class="line">        @(<span class="keyword">posedge</span> i_clk);</span><br><span class="line"></span><br><span class="line">        i_en&lt;=<span class="number">1&#x27;b1</span>;</span><br><span class="line">        i_data&lt;=<span class="number">8&#x27;b0</span>;</span><br><span class="line">        @(<span class="keyword">posedge</span> i_clk);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">repeat</span>(<span class="number">255</span>) <span class="keyword">begin</span></span><br><span class="line">            i_data&lt;=i_data+<span class="number">8&#x27;b1</span>;</span><br><span class="line">            @(<span class="keyword">posedge</span> i_clk);</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        i_en&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line">        i_data&lt;=<span class="number">8&#x27;b0</span>;</span><br><span class="line"></span><br><span class="line">        #<span class="number">1000</span>;</span><br><span class="line">        <span class="built_in">$stop</span>;</span><br><span class="line">    <span class="keyword">end</span> </span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用always对输出数据进行监控</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(o_vld) </span><br><span class="line">            <span class="built_in">$display</span>(<span class="string">&quot;o_gray is:%b at time %d&quot;</span>,o_gray,<span class="built_in">$time</span>);</span><br><span class="line">        <span class="keyword">else</span> ;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="4-仿真结果-8"><a href="#4-仿真结果-8" class="headerlink" title="4.仿真结果"></a>4.仿真结果</h2><p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230203175346897.png" alt="image-20230203175346897"></p>
<p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230203180812501.png" alt="image-20230203180812501"></p>
<hr>
<h1 id="格雷码转换的快速算法"><a href="#格雷码转换的快速算法" class="headerlink" title="格雷码转换的快速算法"></a>格雷码转换的快速算法</h1><h2 id="1-关键点-9"><a href="#1-关键点-9" class="headerlink" title="1.关键点"></a>1.关键点</h2><ul>
<li><p>二进制码的最高位直接赋值给格雷码的最高位</p>
</li>
<li><p>对于次高位到最低位，使用二进制码相邻位异或的方式获取：</p>
<ul>
<li>若二进制码字的第i位和i+1位相同，则第i位的格雷码为0</li>
<li>若二进制码字的第i为和i+1位不同，则第i位的格雷码位1</li>
</ul>
</li>
<li><p>用generate语法实现异或处理</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">genvar</span> i;</span><br><span class="line"><span class="keyword">generate</span></span><br><span class="line">    <span class="keyword">for</span>(i=MSB-<span class="number">1</span>;i&gt;=<span class="number">0</span>;i=i-<span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">            o_gray[i]&lt;=i_data[i]^i_data[i+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endgenerate</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="2-源代码-9"><a href="#2-源代码-9" class="headerlink" title="2.源代码"></a>2.源代码</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> grayCode_quickMethod_design #(</span><br><span class="line">    <span class="keyword">parameter</span> MSB = <span class="number">3</span></span><br><span class="line">    )</span><br><span class="line">    (</span><br><span class="line">        i_clk,</span><br><span class="line">        i_rst_n,</span><br><span class="line">        i_en,</span><br><span class="line">        i_data,</span><br><span class="line">        o_vld,</span><br><span class="line">        o_gray</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> i_clk;</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> i_rst_n;</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> i_en;</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> [MSB:<span class="number">0</span>] i_data;</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> o_vld;</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [MSB:<span class="number">0</span>] o_gray;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(!i_rst_n)</span><br><span class="line">            o_vld&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            o_vld&lt;=i_en;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">        o_gray[MSB]&lt;=i_data[MSB];</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">genvar</span> i;</span><br><span class="line">    <span class="keyword">generate</span></span><br><span class="line">        <span class="keyword">for</span>(i=MSB-<span class="number">1</span>;i&gt;=<span class="number">0</span>;i=i-<span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">                o_gray[i]&lt;=i_data[i]^i_data[i+<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">endgenerate</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="3-Testbench-9"><a href="#3-Testbench-9" class="headerlink" title="3.Testbench"></a>3.Testbench</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> CLK_PERIOD 20</span></span><br><span class="line"><span class="keyword">module</span> grayCode_quickMethod_tb;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">parameter</span> GRAY_MSB=<span class="number">7</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> i_clk;</span><br><span class="line">    <span class="keyword">reg</span> i_rst_n;</span><br><span class="line">    <span class="keyword">reg</span> i_en;</span><br><span class="line">    <span class="keyword">reg</span> [GRAY_MSB:<span class="number">0</span>] i_data;</span><br><span class="line">    <span class="keyword">wire</span> o_vld;</span><br><span class="line">    <span class="keyword">wire</span> [GRAY_MSB:<span class="number">0</span>] o_gray;</span><br><span class="line"></span><br><span class="line">    grayCode_quickMethod_design #(</span><br><span class="line">        <span class="variable">.MSB</span>(GRAY_MSB)</span><br><span class="line">        )</span><br><span class="line">        grayCode_quickMethod_design_U1(</span><br><span class="line">        <span class="variable">.i_clk</span>(i_clk),</span><br><span class="line">        <span class="variable">.i_rst_n</span>(i_rst_n),</span><br><span class="line">        <span class="variable">.i_en</span>(i_en),</span><br><span class="line">        <span class="variable">.i_data</span>(i_data),</span><br><span class="line">        <span class="variable">.o_vld</span>(o_vld),</span><br><span class="line">        <span class="variable">.o_gray</span>(o_gray)</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">    <span class="comment">//时钟信号的产生</span></span><br><span class="line">    <span class="keyword">initial</span> i_clk&lt;=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">always</span> <span class="variable">#(`CLK_PERIOD/2)</span> i_clk&lt;=~i_clk;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//复位信号的产生</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        i_rst_n&lt;=<span class="number">0</span>;</span><br><span class="line">        #<span class="number">1000</span> i_rst_n&lt;=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//输入激励的产生</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        i_en&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line">        i_data&lt;=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">$display</span>(<span class="string">&quot;The value of GRAY_MSB is %0d&quot;</span>,GRAY_MSB);</span><br><span class="line">        @(<span class="keyword">posedge</span> i_rst_n);<span class="comment">//等待复位完成</span></span><br><span class="line"></span><br><span class="line">        @(<span class="keyword">posedge</span> i_clk);</span><br><span class="line">        i_en&lt;=<span class="number">1&#x27;b1</span>;</span><br><span class="line">        i_data&lt;=<span class="number">0</span>;</span><br><span class="line">        @(<span class="keyword">posedge</span> i_clk);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">repeat</span>(<span class="number">2</span>**(GRAY_MSB+<span class="number">1</span>)-<span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">            i_data&lt;=i_data+<span class="number">1</span>;</span><br><span class="line">            @(<span class="keyword">posedge</span> i_clk);</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">        @(<span class="keyword">posedge</span> i_clk);</span><br><span class="line">            i_en&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">$stop</span>;</span><br><span class="line">    <span class="keyword">end</span> </span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用always对输出数据进行监控</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(o_vld)</span><br><span class="line">            <span class="built_in">$display</span>(<span class="string">&quot;o_gray is:%b&quot;</span>,o_gray);</span><br><span class="line">        <span class="keyword">else</span> ;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="4-仿真结果-9"><a href="#4-仿真结果-9" class="headerlink" title="4.仿真结果"></a>4.仿真结果</h2><p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230203194948495.png" alt="image-20230203194948495"></p>
<hr>
<h1 id="Testbench中文本文件写入操作"><a href="#Testbench中文本文件写入操作" class="headerlink" title="Testbench中文本文件写入操作"></a>Testbench中文本文件写入操作</h1><h2 id="1-关键点-10"><a href="#1-关键点-10" class="headerlink" title="1.关键点"></a>1.关键点</h2><ul>
<li><code>$fopen</code>的用法<ul>
<li><code>文件描述符=$fopen(&quot;文件名&quot;,&quot;文件操作类型&quot;)</code></li>
<li>文件操作类型：<ul>
<li><code>“r”</code>：读取文件</li>
<li><code>“w”</code>：写入文件</li>
<li><code>“a”</code>：在文件末尾追加文件</li>
</ul>
</li>
</ul>
</li>
<li><code>$fclose</code>的用法<ul>
<li><code>$fclose(&quot;文件描述符&quot;)</code></li>
</ul>
</li>
<li><code>$fwrite</code>的用法<ul>
<li><code>$fwrite(&quot;文件描述符&quot;,&quot;字符串与数据格式&quot;,变量)</code></li>
</ul>
</li>
</ul>
<h2 id="2-源代码-10"><a href="#2-源代码-10" class="headerlink" title="2.源代码"></a>2.源代码</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> gray8b_based_LUT_design(</span><br><span class="line">    i_clk,</span><br><span class="line">    i_rst_n,</span><br><span class="line">    i_en,</span><br><span class="line">    i_data,</span><br><span class="line">    o_vld,</span><br><span class="line">    o_gray</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> i_clk;</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> i_en;</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] i_data;</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> i_rst_n;</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">wire</span> o_vld;</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] o_gray;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//打两拍操作</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] r_vld;</span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(!i_rst_n)</span><br><span class="line">            r_vld&lt;=<span class="number">2&#x27;b00</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            r_vld&lt;=&#123;r_vld[<span class="number">0</span>],i_en&#125;;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> o_vld=r_vld[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    blk_mem_gen_0 blk_mem_gen_0_U (</span><br><span class="line">        <span class="variable">.clka</span>(i_clk),    <span class="comment">// input wire clka</span></span><br><span class="line">        <span class="variable">.addra</span>(i_data),  <span class="comment">// input wire [7 : 0] addra</span></span><br><span class="line">        <span class="variable">.douta</span>(o_gray)  <span class="comment">// output wire [7 : 0] douta</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="3-Testbench-10"><a href="#3-Testbench-10" class="headerlink" title="3.Testbench"></a>3.Testbench</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> CLK_PERIOD 20</span></span><br><span class="line"> <span class="keyword">module</span> grab8b_based_LUT_tb;</span><br><span class="line">    <span class="keyword">reg</span> i_clk;</span><br><span class="line">    <span class="keyword">reg</span> i_en;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] i_data;</span><br><span class="line">    <span class="keyword">reg</span> i_rst_n;</span><br><span class="line">    <span class="keyword">wire</span> o_vld;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] o_gray;</span><br><span class="line"></span><br><span class="line">    gray8b_based_LUT_design gray8b_based_LUT_design_U1(</span><br><span class="line">        <span class="variable">.i_clk</span>(i_clk),</span><br><span class="line">        <span class="variable">.i_rst_n</span>(i_rst_n),</span><br><span class="line">        <span class="variable">.i_en</span>(i_en),</span><br><span class="line">        <span class="variable">.i_data</span>(i_data),</span><br><span class="line">        <span class="variable">.o_vld</span>(o_vld),</span><br><span class="line">        <span class="variable">.o_gray</span>(o_gray)</span><br><span class="line">    );                 </span><br><span class="line"></span><br><span class="line">    <span class="comment">//时钟信号的产生</span></span><br><span class="line">    <span class="keyword">initial</span> i_clk&lt;=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">always</span> <span class="variable">#(`CLK_PERIOD/2)</span> i_clk&lt;=~i_clk;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//复位信号的产生</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        i_rst_n&lt;=<span class="number">0</span>;</span><br><span class="line">        #<span class="number">1000</span> i_rst_n&lt;=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">integer</span>  wfile;</span><br><span class="line">    <span class="comment">//输入激励的产生</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        i_en&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line">        i_data&lt;=<span class="number">8&#x27;b0</span>;</span><br><span class="line">        @(<span class="keyword">posedge</span> i_rst_n);<span class="comment">//等待复位完成</span></span><br><span class="line">        @(<span class="keyword">posedge</span> i_clk);</span><br><span class="line"></span><br><span class="line">        i_en&lt;=<span class="number">1&#x27;b1</span>;</span><br><span class="line">        i_data&lt;=<span class="number">8&#x27;b0</span>;</span><br><span class="line">        @(<span class="keyword">posedge</span> i_clk);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">repeat</span>(<span class="number">255</span>) <span class="keyword">begin</span></span><br><span class="line">            i_data&lt;=i_data+<span class="number">8&#x27;b1</span>;</span><br><span class="line">            @(<span class="keyword">posedge</span> i_clk);</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        i_en&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line">        #<span class="number">1000</span>;</span><br><span class="line">        <span class="built_in">$fclose</span>(wfile);<span class="comment">//关闭文件</span></span><br><span class="line">        <span class="built_in">$stop</span>;</span><br><span class="line">    <span class="keyword">end</span> </span><br><span class="line"></span><br><span class="line">    <span class="comment">//文件的写入操作</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        wfile=<span class="built_in">$fopen</span>(<span class="string">&quot;D:/App_Data_File/Vivado_data/Vivado_project/gray8b_based_LUT_design_for_fileWrite/output_file/result_data.txt&quot;</span>,<span class="string">&quot;w&quot;</span>);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">//使用always对输出数据进行监控</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(o_vld) </span><br><span class="line">            <span class="built_in">$fwrite</span>(wfile,<span class="string">&quot;%b\n&quot;</span>,o_gray);<span class="comment">//$fdisplay与$fwrite用法一致，只是$fdisplay可以自动换行</span></span><br><span class="line">        <span class="keyword">else</span> ;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="4-仿真结果-10"><a href="#4-仿真结果-10" class="headerlink" title="4.仿真结果"></a>4.仿真结果</h2><p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230204220423725.png" alt="image-20230204220423725"></p>
<hr>
<h1 id="Testbench中文本文件读取操作"><a href="#Testbench中文本文件读取操作" class="headerlink" title="Testbench中文本文件读取操作"></a>Testbench中文本文件读取操作</h1><h2 id="1-关键点-11"><a href="#1-关键点-11" class="headerlink" title="1.关键点"></a>1.关键点</h2><ul>
<li>十六进制文件读取$readmemh：<code>$readmenh(&quot;文件名&quot;,存储器名,起始地址,结束地址)</code></li>
<li>二进制文件读取$readmemb：<code>$readmenb(&quot;文件名&quot;,存储器名,起始地址,结束地址)</code></li>
</ul>
<h2 id="2-源代码-11"><a href="#2-源代码-11" class="headerlink" title="2.源代码"></a>2.源代码</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> gray8b_based_LUT_design(</span><br><span class="line">    i_clk,</span><br><span class="line">    i_rst_n,</span><br><span class="line">    i_en,</span><br><span class="line">    i_data,</span><br><span class="line">    o_vld,</span><br><span class="line">    o_gray</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> i_clk;</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> i_en;</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] i_data;</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> i_rst_n;</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">wire</span> o_vld;</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] o_gray;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//打两拍操作</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] r_vld;</span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(!i_rst_n)</span><br><span class="line">            r_vld&lt;=<span class="number">2&#x27;b00</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            r_vld&lt;=&#123;r_vld[<span class="number">0</span>],i_en&#125;;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> o_vld=r_vld[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    blk_mem_gen_0 blk_mem_gen_0_U (</span><br><span class="line">        <span class="variable">.clka</span>(i_clk),    <span class="comment">// input wire clka</span></span><br><span class="line">        <span class="variable">.addra</span>(i_data),  <span class="comment">// input wire [7 : 0] addra</span></span><br><span class="line">        <span class="variable">.douta</span>(o_gray)  <span class="comment">// output wire [7 : 0] douta</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="3-Testbench-11"><a href="#3-Testbench-11" class="headerlink" title="3.Testbench"></a>3.Testbench</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> CLK_PERIOD 20</span></span><br><span class="line"> <span class="keyword">module</span> grab8b_based_LUT_tb;</span><br><span class="line">    <span class="keyword">reg</span> i_clk;</span><br><span class="line">    <span class="keyword">reg</span> i_en;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] i_data;</span><br><span class="line">    <span class="keyword">reg</span> i_rst_n;</span><br><span class="line">    <span class="keyword">wire</span> o_vld;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] o_gray;</span><br><span class="line"></span><br><span class="line">    gray8b_based_LUT_design gray8b_based_LUT_design_U1(</span><br><span class="line">        <span class="variable">.i_clk</span>(i_clk),</span><br><span class="line">        <span class="variable">.i_rst_n</span>(i_rst_n),</span><br><span class="line">        <span class="variable">.i_en</span>(i_en),</span><br><span class="line">        <span class="variable">.i_data</span>(i_data),</span><br><span class="line">        <span class="variable">.o_vld</span>(o_vld),</span><br><span class="line">        <span class="variable">.o_gray</span>(o_gray)</span><br><span class="line">    );                 </span><br><span class="line"></span><br><span class="line">    <span class="comment">//时钟信号的产生</span></span><br><span class="line">    <span class="keyword">initial</span> i_clk&lt;=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">always</span> <span class="variable">#(`CLK_PERIOD/2)</span> i_clk&lt;=~i_clk;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//复位信号的产生</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        i_rst_n&lt;=<span class="number">0</span>;</span><br><span class="line">        #<span class="number">1000</span> i_rst_n&lt;=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//文本文件的读取</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] data_mem[<span class="number">255</span>:<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">initial</span> <span class="built_in">$readmemb</span>(<span class="string">&quot;D:/App_Data_File/Vivado_data/Vivado_project/gray8b_based_LUT_design_for_ReadFile/input_file/gray8_data.txt&quot;</span>,data_mem);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//输入激励的产生</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        i_en&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line">        i_data&lt;=<span class="number">8&#x27;b0</span>;</span><br><span class="line">        @(<span class="keyword">posedge</span> i_rst_n);<span class="comment">//等待复位完成</span></span><br><span class="line">        @(<span class="keyword">posedge</span> i_clk);</span><br><span class="line"></span><br><span class="line">        i_en&lt;=<span class="number">1&#x27;b1</span>;</span><br><span class="line">        i_data&lt;=<span class="number">8&#x27;b0</span>;</span><br><span class="line">        @(<span class="keyword">posedge</span> i_clk);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">repeat</span>(<span class="number">255</span>) <span class="keyword">begin</span></span><br><span class="line">            i_data&lt;=i_data+<span class="number">8&#x27;b1</span>;</span><br><span class="line">            @(<span class="keyword">posedge</span> i_clk);</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        </span><br><span class="line">        i_en&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line">        #<span class="number">1000</span>;</span><br><span class="line">        <span class="built_in">$stop</span>;</span><br><span class="line">    <span class="keyword">end</span> </span><br><span class="line"></span><br><span class="line">    <span class="comment">//比较读取文件中的数据与实际生成的数据是否相等</span></span><br><span class="line">    <span class="keyword">integer</span> cnt;</span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(!i_rst_n)</span><br><span class="line">            cnt&lt;=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(o_vld)</span><br><span class="line">            cnt&lt;=cnt+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(o_vld)</span><br><span class="line">            <span class="built_in">$display</span>(<span class="string">&quot;%b\n%b\n&quot;</span>,o_gray,data_mem[cnt]);</span><br><span class="line">        <span class="keyword">else</span> ;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="4-仿真结果-11"><a href="#4-仿真结果-11" class="headerlink" title="4.仿真结果"></a>4.仿真结果</h2><p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230204224322669.png" alt="image-20230204224322669"></p>
<hr>
<h1 id="基于随机数的自动化仿真测试"><a href="#基于随机数的自动化仿真测试" class="headerlink" title="基于随机数的自动化仿真测试"></a>基于随机数的自动化仿真测试</h1><ul>
<li>通过自动生成随机数测试格雷码转换的快速算法模块是否正确</li>
</ul>
<h2 id="1-关键点-12"><a href="#1-关键点-12" class="headerlink" title="1.关键点"></a>1.关键点</h2><ul>
<li><p><code>$random(seed)</code></p>
</li>
<li><p>$random表示产生一个32位的随机数，如果不设置seed，每次取得的随机数是相同的</p>
</li>
<li><p><code>&#123;$random&#125;%65536;</code>//产生0~65535的随机数，若不加括号，即为<code>$random%65536</code>，则产生-65535-+65535之间的随机数</p>
</li>
<li><p><code>rand=min+&#123;$random&#125;&amp;(max-min+1)</code>产生一个在min-max之间的随机数</p>
</li>
<li><p><strong>因为格雷码快速算法要延后一个时钟周期才能计算出结果，故对文件中的数据寻址时寻址地址也要延迟一个时钟周期</strong></p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">reg</span>[<span class="number">7</span>:<span class="number">0</span>] r_data;<span class="comment">//用r_data作为寻址地址</span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line"> 	r_data &lt;= i_data;</span><br><span class="line"> <span class="keyword">end</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="2-源代码-12"><a href="#2-源代码-12" class="headerlink" title="2.源代码"></a>2.源代码</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> gray8b_based_LUT_design #(</span><br><span class="line">    	<span class="keyword">parameter</span> MSB = <span class="number">3</span></span><br><span class="line">    )</span><br><span class="line">    (</span><br><span class="line">    	<span class="keyword">input</span> i_clk,</span><br><span class="line">    	<span class="keyword">input</span> i_rst_n,</span><br><span class="line">    	<span class="keyword">input</span> i_en,</span><br><span class="line">    	<span class="keyword">input</span>[MSB:<span class="number">0</span>] i_data,</span><br><span class="line">    	<span class="keyword">output</span> <span class="keyword">reg</span> o_vld,</span><br><span class="line">    	<span class="keyword">output</span> <span class="keyword">reg</span>[MSB:<span class="number">0</span>] o_gray</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">if</span>(!i_rst_n) </span><br><span class="line">            o_vld &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">else</span> </span><br><span class="line">            o_vld &lt;= i_en;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">    	o_gray[MSB] &lt;= i_data[MSB];</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">genvar</span> i;</span><br><span class="line">    <span class="keyword">generate</span></span><br><span class="line">    	<span class="keyword">for</span>(i=MSB-<span class="number">1</span>; i&gt;=<span class="number">0</span>; i=i-<span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">    		<span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">    			o_gray[i] &lt;= i_data[i] ^ i_data[i+<span class="number">1</span>];	</span><br><span class="line">    		<span class="keyword">end</span></span><br><span class="line">    	<span class="keyword">end</span></span><br><span class="line">    <span class="keyword">endgenerate</span>	</span><br><span class="line">	</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="3-Testbench-12"><a href="#3-Testbench-12" class="headerlink" title="3.Testbench"></a>3.Testbench</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> CLK_PERIOD 20</span></span><br><span class="line"> <span class="keyword">module</span> grab8b_based_LUT_tb;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">parameter</span> GRAY_MSB	= <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> i_clk;</span><br><span class="line">    <span class="keyword">reg</span> i_en;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] i_data;</span><br><span class="line">    <span class="keyword">reg</span> i_rst_n;</span><br><span class="line">    <span class="keyword">wire</span> o_vld;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] o_gray;</span><br><span class="line"></span><br><span class="line">    gray8b_based_LUT_design #(</span><br><span class="line">	    <span class="variable">.MSB</span>(GRAY_MSB)</span><br><span class="line">        )   </span><br><span class="line">        gray8b_based_LUT_design_U1(</span><br><span class="line">        <span class="variable">.i_clk</span>(i_clk),</span><br><span class="line">        <span class="variable">.i_rst_n</span>(i_rst_n),</span><br><span class="line">        <span class="variable">.i_en</span>(i_en),</span><br><span class="line">        <span class="variable">.i_data</span>(i_data),</span><br><span class="line">        <span class="variable">.o_vld</span>(o_vld),</span><br><span class="line">        <span class="variable">.o_gray</span>(o_gray)</span><br><span class="line">        );                 </span><br><span class="line"></span><br><span class="line">    <span class="comment">//时钟信号的产生</span></span><br><span class="line">    <span class="keyword">initial</span> i_clk&lt;=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">always</span> <span class="variable">#(`CLK_PERIOD/2)</span> i_clk&lt;=~i_clk;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//复位信号的产生</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        i_rst_n&lt;=<span class="number">0</span>;</span><br><span class="line">        #<span class="number">1000</span> i_rst_n&lt;=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//文本文件的读取</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] data_mem[<span class="number">255</span>:<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="built_in">$readmemb</span>(<span class="string">&quot;D:/App_Data_File/Vivado_data/Vivado_project/gray8b_based_LUT_design_for_RandomTest/input_file/gray8_data.txt&quot;</span>,data_mem);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//输入激励的产生</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        i_en&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line">        i_data&lt;=<span class="number">8&#x27;b0</span>;</span><br><span class="line">        @(<span class="keyword">posedge</span> i_rst_n);<span class="comment">//等待复位完成</span></span><br><span class="line"></span><br><span class="line">	    <span class="keyword">repeat</span>(<span class="number">2</span>**(GRAY_MSB+<span class="number">1</span>)) <span class="keyword">begin</span></span><br><span class="line">	    	@(<span class="keyword">posedge</span> i_clk);</span><br><span class="line">	    	i_en &lt;= <span class="number">&#x27;b1</span>;</span><br><span class="line">	    	i_data &lt;= &#123;<span class="built_in">$random</span>&#125; % <span class="number">256</span>;	<span class="comment">//产生0~255的随机数</span></span><br><span class="line">	    <span class="keyword">end</span></span><br><span class="line">	    @(<span class="keyword">posedge</span> i_clk);</span><br><span class="line">	    i_en &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">	    #<span class="number">100</span>;</span><br><span class="line">    </span><br><span class="line">	    <span class="built_in">$display</span>(<span class="string">&quot;Test Finish!&quot;</span>);</span><br><span class="line"></span><br><span class="line">	    <span class="built_in">$stop</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//比较读取文件中的数据与实际生成的数据是否相等</span></span><br><span class="line">    <span class="keyword">reg</span>[<span class="number">7</span>:<span class="number">0</span>] r_data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">    	r_data &lt;= i_data;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">if</span>(o_vld) <span class="keyword">begin</span></span><br><span class="line">    		<span class="built_in">$display</span>(<span class="string">&quot;i_data = %b\no_gray   = %b\ndata_mem = %b&quot;</span>,r_data,o_gray,data_mem[r_data]);</span><br><span class="line">    		<span class="keyword">if</span>(o_gray == data_mem[r_data]) <span class="keyword">begin</span></span><br><span class="line">    			<span class="built_in">$display</span>(<span class="string">&quot;Successful!\n&quot;</span>);</span><br><span class="line">    		<span class="keyword">end</span></span><br><span class="line">    		<span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">    			<span class="built_in">$display</span>(<span class="string">&quot;Fail!&quot;</span>);</span><br><span class="line">    			<span class="built_in">$stop</span>;</span><br><span class="line">    		<span class="keyword">end</span></span><br><span class="line">    	<span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="4-仿真结果-12"><a href="#4-仿真结果-12" class="headerlink" title="4.仿真结果"></a>4.仿真结果</h2><p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230204234624012.png" alt="image-20230204234624012"></p>
<hr>
<h1 id="可配置的PWM设计"><a href="#可配置的PWM设计" class="headerlink" title="可配置的PWM设计"></a>可配置的PWM设计</h1><ul>
<li>PWM波的产生，有通过i_times控制产生PWM波重复的次数</li>
</ul>
<h2 id="1-关键点-13"><a href="#1-关键点-13" class="headerlink" title="1.关键点"></a>1.关键点</h2><p>时序分析：</p>
<ul>
<li>首先需要需要i_en信号的上升沿与计数结束的标志信号w_end_en置1，从而生成控制计数器工作的使能信号r_cnt_en</li>
<li>在使能信号r_cnt_en的控制下进行PWM的周期计数，当周期计数达到其值时，次数计数加1，从而实现PWM波的次数计数</li>
</ul>
<p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230205235810859.png" alt="image-20230205235810859"></p>
<p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230206000138514.png" alt="image-20230206000138514"></p>
<h2 id="2-源代码-13"><a href="#2-源代码-13" class="headerlink" title="2.源代码"></a>2.源代码</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> PWM_design(</span><br><span class="line">	<span class="keyword">input</span> i_clk,	<span class="comment">//50MHz（20ns）时钟</span></span><br><span class="line">	<span class="keyword">input</span> i_rst_n,	<span class="comment">//复位</span></span><br><span class="line">	<span class="keyword">input</span> i_en,	<span class="comment">//使能</span></span><br><span class="line">	<span class="keyword">input</span>[<span class="number">31</span>:<span class="number">0</span>] i_periord,	<span class="comment">//PWM的周期</span></span><br><span class="line">	<span class="keyword">input</span>[<span class="number">31</span>:<span class="number">0</span>] i_high,	<span class="comment">//高电平时间</span></span><br><span class="line">	<span class="keyword">input</span>[<span class="number">15</span>:<span class="number">0</span>] i_times,	<span class="comment">//次数</span></span><br><span class="line">	<span class="keyword">output</span> <span class="keyword">reg</span> o_pwm	<span class="comment">//PWM信号</span></span><br><span class="line">    );</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">reg</span>[<span class="number">1</span>:<span class="number">0</span>] r_en;</span><br><span class="line">    <span class="keyword">wire</span> w_pos_en;</span><br><span class="line">    <span class="keyword">wire</span> w_end_en;</span><br><span class="line">    <span class="keyword">reg</span> r_cnt_en;	<span class="comment">//内部各个计数器工作的使能信号</span></span><br><span class="line">    <span class="keyword">reg</span>[<span class="number">31</span>:<span class="number">0</span>] r_pcnt;	<span class="comment">//周期计数器</span></span><br><span class="line">    <span class="keyword">reg</span>[<span class="number">15</span>:<span class="number">0</span>] r_tcnt;	<span class="comment">//周期次数的计数器</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//产生i_en的上升沿标志信号</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(!i_rst_n)</span><br><span class="line">            r_en &lt;= <span class="number">2&#x27;b00</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">    	    r_en &lt;= &#123;r_en[<span class="number">0</span>],i_en&#125;;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">assign</span> w_pos_en = ~r_en[<span class="number">1</span>] &amp; r_en[<span class="number">0</span>];	</span><br><span class="line"></span><br><span class="line">    <span class="comment">/////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//产生内部PWM结束信号</span></span><br><span class="line">    <span class="keyword">assign</span> w_end_en = (r_pcnt == (i_periord-<span class="number">1</span>)) &amp;&amp; (r_tcnt == (i_times-<span class="number">1</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//产生内部各个计数器工作的是能信号</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">if</span>(!i_rst_n) </span><br><span class="line">            r_cnt_en &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">else</span> <span class="keyword">if</span>(w_pos_en) </span><br><span class="line">            r_cnt_en &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">    	<span class="keyword">else</span> <span class="keyword">if</span>(w_end_en) </span><br><span class="line">            r_cnt_en &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">else</span> </span><br><span class="line">            r_cnt_en &lt;= r_cnt_en;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//周期计数</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">if</span>(!r_cnt_en) </span><br><span class="line">            r_pcnt &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">else</span> <span class="keyword">if</span>(r_pcnt &lt; (i_periord-<span class="number">1</span>)) </span><br><span class="line">            r_pcnt &lt;= r_pcnt+<span class="number">1</span>;</span><br><span class="line">    	<span class="keyword">else</span> </span><br><span class="line">            r_pcnt &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//周期次数计数	</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">if</span>(!r_cnt_en) </span><br><span class="line">            r_tcnt &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">else</span> <span class="keyword">if</span>(r_pcnt == (i_periord-<span class="number">1</span>)) </span><br><span class="line">            r_tcnt &lt;= r_tcnt+<span class="number">1</span>;</span><br><span class="line">    	<span class="keyword">else</span> </span><br><span class="line">            r_tcnt &lt;= r_tcnt;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//输出PWM波形</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">if</span>(!i_rst_n) </span><br><span class="line">            o_pwm &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">else</span> <span class="keyword">if</span>((r_pcnt &gt; <span class="number">32&#x27;d0</span>) &amp;&amp; (r_pcnt &lt;= i_high)) </span><br><span class="line">            o_pwm &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">    	<span class="keyword">else</span> </span><br><span class="line">            o_pwm &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="3-Testbench-13"><a href="#3-Testbench-13" class="headerlink" title="3.Testbench"></a>3.Testbench</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> PWM_tb;</span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//参数定义</span></span><br><span class="line">    <span class="meta">`<span class="keyword">define</span> CLK_PERIORD		20		</span><span class="comment">//时钟周期设置为20ns（50MHz）	</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//接口申明</span></span><br><span class="line">    <span class="keyword">reg</span> clk;</span><br><span class="line">    <span class="keyword">reg</span> rst_n;</span><br><span class="line">    <span class="keyword">reg</span> i_en;	<span class="comment">//使能</span></span><br><span class="line">    <span class="keyword">reg</span>[<span class="number">31</span>:<span class="number">0</span>] i_periord;	<span class="comment">//周期，单位：40ns</span></span><br><span class="line">    <span class="keyword">reg</span>[<span class="number">31</span>:<span class="number">0</span>] i_high;	<span class="comment">//高电平时间，单位：40ns</span></span><br><span class="line">    <span class="keyword">reg</span>[<span class="number">15</span>:<span class="number">0</span>] i_times;	<span class="comment">//次数</span></span><br><span class="line">    <span class="keyword">wire</span> o_pwm;		<span class="comment">//PWM信号</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////////////////////////////	</span></span><br><span class="line">    <span class="comment">//对被测试的设计进行例化</span></span><br><span class="line">    PWM_design PWM_design_U1(</span><br><span class="line">    	<span class="variable">.i_clk</span>(clk),</span><br><span class="line">    	<span class="variable">.i_rst_n</span>(rst_n),</span><br><span class="line">    	<span class="variable">.i_en</span>(i_en),</span><br><span class="line">    	<span class="variable">.i_periord</span>(i_periord),</span><br><span class="line">    	<span class="variable">.i_high</span>(i_high),</span><br><span class="line">    	<span class="variable">.i_times</span>(i_times),</span><br><span class="line">    	<span class="variable">.o_pwm</span>(o_pwm)</span><br><span class="line">        );	</span><br><span class="line">    </span><br><span class="line">    <span class="comment">////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//复位和时钟产生</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">    	clk &lt;= <span class="number">0</span>;</span><br><span class="line">    	rst_n &lt;= <span class="number">0</span>;</span><br><span class="line">    	#<span class="number">1000</span>;</span><br><span class="line">    	rst_n &lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">always</span> <span class="variable">#(`CLK_PERIORD/2)</span> clk = ~clk;	</span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//测试激励产生</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">    	i_en		&lt;= <span class="number">1&#x27;b0</span>;	<span class="comment">//使能</span></span><br><span class="line">    	i_periord	&lt;= <span class="number">32&#x27;d0</span>;	<span class="comment">//周期，单位：40ns</span></span><br><span class="line">    	i_high		&lt;= <span class="number">32&#x27;d0</span>;	<span class="comment">//高电平时间，单位：40ns</span></span><br><span class="line">    	i_times		&lt;= <span class="number">32&#x27;d0</span>;	<span class="comment">//次数</span></span><br><span class="line"></span><br><span class="line">    	@(<span class="keyword">posedge</span> rst_n);	<span class="comment">//等待复位完成</span></span><br><span class="line">    	#<span class="number">1000</span>;</span><br><span class="line">    	@(<span class="keyword">posedge</span> clk);</span><br><span class="line">    </span><br><span class="line">    	task_pwm_setting(<span class="number">2500</span>,<span class="number">250</span>,<span class="number">3</span>);</span><br><span class="line">    </span><br><span class="line">    	#<span class="number">100_000</span>;</span><br><span class="line">    </span><br><span class="line">    	task_pwm_setting(<span class="number">1000</span>,<span class="number">500</span>,<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    	#<span class="number">10_000</span>;</span><br><span class="line">    	<span class="built_in">$stop</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">task</span> task_pwm_setting;</span><br><span class="line">    	<span class="keyword">input</span>[<span class="number">31</span>:<span class="number">0</span>] pwm_periord;</span><br><span class="line">    	<span class="keyword">input</span>[<span class="number">31</span>:<span class="number">0</span>] pwm_high;</span><br><span class="line">    	<span class="keyword">input</span>[<span class="number">15</span>:<span class="number">0</span>] pwm_times;</span><br><span class="line">    	<span class="keyword">begin</span></span><br><span class="line">    		@(<span class="keyword">posedge</span> clk);</span><br><span class="line">    		i_en &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">    </span><br><span class="line">    		i_periord &lt;= pwm_periord;</span><br><span class="line">    		i_high &lt;= pwm_high;</span><br><span class="line">    		i_times &lt;= pwm_times;</span><br><span class="line">    		<span class="variable">#(pwm_periord*pwm_times*`CLK_PERIORD)</span>;</span><br><span class="line">    		@(<span class="keyword">posedge</span> clk);</span><br><span class="line">    		i_en &lt;= <span class="number">1&#x27;b0</span>;				</span><br><span class="line">    	<span class="keyword">end</span></span><br><span class="line">    <span class="keyword">endtask</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="4-仿真结果-13"><a href="#4-仿真结果-13" class="headerlink" title="4.仿真结果"></a>4.仿真结果</h2><p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230206000713569.png" alt="image-20230206000713569"></p>
<hr>
<h1 id="超声波测距设计"><a href="#超声波测距设计" class="headerlink" title="超声波测距设计"></a>超声波测距设计</h1><h2 id="1-关键点-14"><a href="#1-关键点-14" class="headerlink" title="1.关键点"></a>1.关键点</h2><ul>
<li><p>超声波测距模块原理：每隔100ms时间，定时产生10us时间的TRIG高脉冲给到超声波测距模块，用于触发超声波模块工作，通过测量ECHO端口高电平持续的时间即可得到距离信息</p>
<p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/%E8%B6%85%E5%A3%B0%E6%B3%A2%E6%B5%8B%E8%B7%9D%E6%A8%A1%E5%9D%97-1675668397252-2.png" alt="超声波测距模块"></p>
</li>
<li><p><strong>模块划分与接口定义</strong>：</p>
<p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/%E7%AB%AF%E5%8F%A3%E5%88%92%E5%88%86%E4%B8%8E%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89-1675669738038-5.png" alt="端口划分与接口定义"></p>
</li>
<li><p><strong>IP核实现乘法器</strong>：</p>
<p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230206163556109.png" alt="image-20230206163556109"></p>
<p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230206164233042.png" alt="image-20230206164233042"></p>
<p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230206164149984.png" alt="image-20230206164149984"></p>
</li>
</ul>
<h2 id="2-源代码-14"><a href="#2-源代码-14" class="headerlink" title="2.源代码"></a>2.源代码</h2><ul>
<li>顶层模块supersonic_wave_design.v</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> supersonic_wave_design(</span><br><span class="line">    <span class="keyword">input</span> i_clk,</span><br><span class="line">    <span class="keyword">input</span> i_rst_n,</span><br><span class="line">    <span class="keyword">input</span> i_echo,</span><br><span class="line">    <span class="keyword">output</span> o_trig,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">13</span>:<span class="number">0</span>] o_s_mm</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">localparam</span> P_CLK_PERIORD=<span class="number">20</span>;</span><br><span class="line">    <span class="keyword">wire</span> w_clk_en;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] w_t_us;</span><br><span class="line"></span><br><span class="line">    en_design #(</span><br><span class="line">    	<span class="variable">.P_CLK_PERIORD</span>(P_CLK_PERIORD)	<span class="comment">//i_clk的时钟周期为20ns</span></span><br><span class="line">    )</span><br><span class="line">    uut_en_design(</span><br><span class="line">    	<span class="variable">.i_clk</span>(i_clk),</span><br><span class="line">    	<span class="variable">.i_rst_n</span>(i_rst_n),</span><br><span class="line">    	<span class="variable">.o_clk_en</span>(w_clk_en)</span><br><span class="line">    );	</span><br><span class="line">    </span><br><span class="line">    trig_design	uut_trig_design(</span><br><span class="line">    	<span class="variable">.i_clk</span>(i_clk),</span><br><span class="line">    	<span class="variable">.i_rst_n</span>(i_rst_n),</span><br><span class="line">    	<span class="variable">.i_clk_en</span>(w_clk_en),</span><br><span class="line">    	<span class="variable">.o_trig</span>(o_trig)</span><br><span class="line">    );	</span><br><span class="line"></span><br><span class="line">    echo_design	uut_echo_design(</span><br><span class="line">    	<span class="variable">.i_clk</span>(i_clk),</span><br><span class="line">    	<span class="variable">.i_rst_n</span>(i_rst_n),</span><br><span class="line">    	<span class="variable">.i_clk_en</span>(w_clk_en),</span><br><span class="line">    	<span class="variable">.i_echo</span>(i_echo),</span><br><span class="line">    	<span class="variable">.o_t_us</span>(w_t_us)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    cal_design uut_cal_design(</span><br><span class="line">        <span class="variable">.i_clk</span>(i_clk),</span><br><span class="line">        <span class="variable">.i_rst_n</span>(i_rst_n),</span><br><span class="line">        <span class="variable">.i_t_us</span>(w_t_us),</span><br><span class="line">        <span class="variable">.o_s_mm</span>(o_s_mm)</span><br><span class="line">    );</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<ul>
<li>子模块：en_design.v</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> en_design #(<span class="keyword">parameter</span> P_CLK_PERIORD = <span class="number">20</span>)</span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">input</span> i_clk,</span><br><span class="line">        <span class="keyword">input</span> i_rst_n,</span><br><span class="line">        <span class="keyword">output</span> <span class="keyword">reg</span> o_clk_en</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">localparam</span> P_DIVCLK_MAX = <span class="number">1000</span>/P_CLK_PERIORD-<span class="number">1</span>;<span class="comment">//分频计数器的最大值</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] r_divcnt;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//对输出时钟i_clk做分频计数，产生1us的时钟使能信号</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(!i_rst_n)</span><br><span class="line">            r_divcnt&lt;=<span class="number">8&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(r_divcnt&lt;P_DIVCLK_MAX)</span><br><span class="line">            r_divcnt&lt;=r_divcnt+<span class="number">8&#x27;b1</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            r_divcnt&lt;=<span class="number">8&#x27;b0</span>;        </span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//输出1us的时钟使能信号</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(!i_rst_n)</span><br><span class="line">            o_clk_en&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(r_divcnt==P_DIVCLK_MAX)</span><br><span class="line">            o_clk_en&lt;=<span class="number">1&#x27;b1</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            o_clk_en&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<ul>
<li>子模块：trig_design.v</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> trig_design(</span><br><span class="line">    <span class="keyword">input</span> i_clk,</span><br><span class="line">    <span class="keyword">input</span> i_rst_n,</span><br><span class="line">    <span class="keyword">input</span> i_clk_en,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> o_trig</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">localparam</span> P_TRIG_PERIORD_MAX=<span class="number">100_000</span>-<span class="number">1</span>;<span class="comment">//100ms的计数最大值</span></span><br><span class="line">    <span class="keyword">localparam</span> P_TRIG_HIGH_MAX=<span class="number">10</span>;<span class="comment">//10us高脉冲保持时间</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">16</span>:<span class="number">0</span>] r_tricnt;</span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//100ms的周期计数</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(!i_rst_n)</span><br><span class="line">            r_tricnt&lt;=<span class="number">17&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(i_clk_en) <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span>(r_tricnt&lt;P_TRIG_PERIORD_MAX)</span><br><span class="line">                r_tricnt&lt;=r_tricnt+<span class="number">17&#x27;b1</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                r_tricnt&lt;=<span class="number">17&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            r_tricnt&lt;=r_tricnt;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//产生保持10us的高脉冲o_trig信号</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(!i_rst_n)</span><br><span class="line">            o_trig&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(r_tricnt&gt;<span class="number">17&#x27;b0</span> &amp;&amp; r_tricnt&lt;=P_TRIG_HIGH_MAX)</span><br><span class="line">            o_trig&lt;=<span class="number">1&#x27;b1</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            o_trig&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<ul>
<li>子模块：echo_design.v</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> echo_design(</span><br><span class="line">    	<span class="keyword">input</span> i_clk,</span><br><span class="line">    	<span class="keyword">input</span> i_rst_n,</span><br><span class="line">    	<span class="keyword">input</span> i_clk_en,</span><br><span class="line">    	<span class="keyword">input</span> i_echo,</span><br><span class="line">    	<span class="keyword">output</span> <span class="keyword">reg</span>[<span class="number">15</span>:<span class="number">0</span>] o_t_us</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span>[<span class="number">1</span>:<span class="number">0</span>] r_echo;</span><br><span class="line">    <span class="keyword">wire</span> pos_echo,neg_echo;</span><br><span class="line">    <span class="keyword">reg</span> r_cnt_en;</span><br><span class="line">    <span class="keyword">reg</span>[<span class="number">15</span>:<span class="number">0</span>] r_echo_cnt;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    超声波测距模块的量程是2mm~4500mm</span></span><br><span class="line"><span class="comment">    根据公式 s = 0.173*t ， t = s/0.173</span></span><br><span class="line"><span class="comment">    11 &lt; t &lt; 26011</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//对i_echo信号锁存2拍，获取边沿检测信号，产生计数使能信号r_cnt_en</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">if</span>(!i_rst_n) </span><br><span class="line">            r_echo &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">else</span> </span><br><span class="line">            r_echo &lt;= &#123;r_echo[<span class="number">0</span>],i_echo&#125;;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">assign</span> pos_echo = ~r_echo[<span class="number">1</span>] &amp; r_echo[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">assign</span> neg_echo = r_echo[<span class="number">1</span>] &amp; ~r_echo[<span class="number">0</span>];	</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">if</span>(!i_rst_n) </span><br><span class="line">            r_cnt_en &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">else</span> <span class="keyword">if</span>(pos_echo) </span><br><span class="line">            r_cnt_en &lt;= <span class="number">&#x27;b1</span>;</span><br><span class="line">    	<span class="keyword">else</span> <span class="keyword">if</span>(neg_echo) </span><br><span class="line">            r_cnt_en &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">else</span> ;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//对i_echo信号的高电平保持时间进行1us为单位的计数</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">if</span>(!i_rst_n) </span><br><span class="line">            r_echo_cnt &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">else</span> <span class="keyword">if</span>(!r_cnt_en) </span><br><span class="line">            r_echo_cnt &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">else</span> <span class="keyword">if</span>(i_clk_en) </span><br><span class="line">            r_echo_cnt &lt;= r_echo_cnt+<span class="number">1</span>;</span><br><span class="line">    	<span class="keyword">else</span> </span><br><span class="line">            r_echo_cnt &lt;= r_echo_cnt;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//对r_echo_cnt计数最大值做锁存</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">if</span>(!i_rst_n) </span><br><span class="line">            o_t_us &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">else</span> <span class="keyword">if</span>(neg_echo)</span><br><span class="line">            o_t_us &lt;= r_echo_cnt;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<ul>
<li>子模块：cal_design.v</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> cal_design(</span><br><span class="line">    <span class="keyword">input</span> i_clk,</span><br><span class="line">    <span class="keyword">input</span> i_rst_n,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">15</span>:<span class="number">0</span>] i_t_us,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">13</span>:<span class="number">0</span>] o_s_mm</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">//s=0.173*t</span></span><br><span class="line">    <span class="comment">//s*4096=0.173*t*4096</span></span><br><span class="line">    <span class="comment">//s*4096=709*t</span></span><br><span class="line">    <span class="comment">//s=709*t/4096</span></span><br><span class="line">    <span class="comment">//s=709*t&gt;&gt;12</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">25</span>:<span class="number">0</span>] w_mult_result;</span><br><span class="line"></span><br><span class="line">    mult_gen_0 mult_gen_0_U1 (</span><br><span class="line">        <span class="variable">.CLK</span>(i_clk),  <span class="comment">// input wire CLK</span></span><br><span class="line">        <span class="variable">.A</span>(<span class="number">10&#x27;d709</span>),      <span class="comment">// input wire [9 : 0] A</span></span><br><span class="line">        <span class="variable">.B</span>(i_t_us),      <span class="comment">// input wire [15 : 0] B</span></span><br><span class="line">        <span class="variable">.P</span>(w_mult_result)      <span class="comment">// output wire [25 : 0] P</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> o_s_mm=w_mult_result[<span class="number">25</span>:<span class="number">12</span>];<span class="comment">//右移12bit，即除以4096</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="3-Testbench-14"><a href="#3-Testbench-14" class="headerlink" title="3.Testbench"></a>3.Testbench</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> supersonic_wave_tb;</span><br><span class="line">    <span class="comment">////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//参数定义</span></span><br><span class="line">    <span class="meta">`<span class="keyword">define</span> CLK_PERIORD		20		</span><span class="comment">//时钟周期设置为20ns（50MHz）	</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//接口申明</span></span><br><span class="line">    <span class="keyword">reg</span> clk;</span><br><span class="line">    <span class="keyword">reg</span> rst_n;</span><br><span class="line">    <span class="keyword">wire</span> o_trig;</span><br><span class="line">    <span class="keyword">reg</span> i_echo;</span><br><span class="line">    <span class="keyword">wire</span>[<span class="number">13</span>:<span class="number">0</span>] o_s_mm;</span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////////////////////////////	</span></span><br><span class="line">    <span class="comment">//对被测试的设计进行例化    </span></span><br><span class="line">    supersonic_wave_design supersonic_wave_design_U1(</span><br><span class="line">        <span class="variable">.i_clk</span>(clk),</span><br><span class="line">        <span class="variable">.i_rst_n</span>(rst_n),</span><br><span class="line">        <span class="variable">.i_echo</span>(i_echo),</span><br><span class="line">        <span class="variable">.o_trig</span>(o_trig),</span><br><span class="line">        <span class="variable">.o_s_mm</span>(o_s_mm)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//复位和时钟产生</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">    	clk &lt;= <span class="number">0</span>;</span><br><span class="line">    	rst_n &lt;= <span class="number">0</span>;</span><br><span class="line">    	#<span class="number">1000</span>;</span><br><span class="line">    	rst_n &lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">always</span> <span class="variable">#(`CLK_PERIORD/2)</span> clk = ~clk;	</span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//测试激励产生</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">    	i_echo = <span class="number">0</span>;</span><br><span class="line">    	@(<span class="keyword">posedge</span> rst_n);	<span class="comment">//等待复位完成</span></span><br><span class="line">    </span><br><span class="line">    	@(<span class="keyword">posedge</span> clk);</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    	#<span class="number">400_000_000</span>;</span><br><span class="line">    </span><br><span class="line">    	<span class="built_in">$stop</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">integer</span> tricnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">integer</span> dly_time;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> o_trig) <span class="keyword">begin</span></span><br><span class="line">    	tricnt = tricnt+<span class="number">1</span>;</span><br><span class="line">    	#<span class="number">5_000</span>;</span><br><span class="line">    	i_echo = <span class="number">1</span>;</span><br><span class="line">    	dly_time = <span class="number">11</span>+&#123;<span class="built_in">$random</span>&#125;%<span class="number">26001</span>;<span class="comment">//11 &lt; t &lt; 26011</span></span><br><span class="line">    	<span class="built_in">$display</span>(<span class="string">&quot;Test %0d:\ndistance of testbench = %0dmm&quot;</span>,tricnt,function_t2s(dly_time));</span><br><span class="line">    	<span class="variable">#(dly_time*1000)</span>;</span><br><span class="line">    	i_echo = <span class="number">0</span>;		</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">    	#<span class="number">1</span>;</span><br><span class="line">    	<span class="built_in">$monitor</span>(<span class="string">&quot;o_s_mm = %0dmm&quot;</span>,o_s_mm);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//函数实现运算 s=0.173t</span></span><br><span class="line">    <span class="keyword">function</span> <span class="keyword">real</span> function_t2s;</span><br><span class="line">    	<span class="keyword">input</span> <span class="keyword">real</span> t;</span><br><span class="line">    	<span class="keyword">begin</span></span><br><span class="line">    		function_t2s = <span class="number">0</span><span class="variable">.173</span>*t;</span><br><span class="line">    	<span class="keyword">end</span></span><br><span class="line">    <span class="keyword">endfunction</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="4-仿真结果-14"><a href="#4-仿真结果-14" class="headerlink" title="4.仿真结果"></a>4.仿真结果</h2><ul>
<li>RTL视图</li>
</ul>
<p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230206165117621.png" alt="image-20230206165117621"></p>
<ul>
<li>打印输出的结果：</li>
</ul>
<p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230206171150590.png" alt="image-20230206171150590"></p>
<hr>
<h1 id="自动售卖机状态机设计"><a href="#自动售卖机状态机设计" class="headerlink" title="自动售卖机状态机设计"></a>自动售卖机状态机设计</h1><ul>
<li>有纸币1/2/5，每次投一张，当总投入金额大于等于6时输出为1</li>
</ul>
<h2 id="1-关键点-15"><a href="#1-关键点-15" class="headerlink" title="1.关键点"></a>1.关键点</h2><ul>
<li>状态机转换图的绘制</li>
</ul>
<p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/%E8%87%AA%E5%8A%A8%E5%94%AE%E5%8D%96%E6%9C%BA%E7%8A%B6%E6%80%81%E8%BD%AC%E5%8C%96%E5%9B%BE-1675676111194-8.png" alt="自动售卖机状态转化图"></p>
<h2 id="2-源代码-15"><a href="#2-源代码-15" class="headerlink" title="2.源代码"></a>2.源代码</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> FSM_design(</span><br><span class="line">	<span class="keyword">input</span> i_clk,</span><br><span class="line">	<span class="keyword">input</span> i_rst_n,</span><br><span class="line">	<span class="keyword">input</span> i_1yuan,</span><br><span class="line">	<span class="keyword">input</span> i_2yuan,</span><br><span class="line">	<span class="keyword">input</span> i_5yuan,</span><br><span class="line">	<span class="keyword">output</span> <span class="keyword">reg</span> o_done</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">/////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//参数和变量的申明</span></span><br><span class="line">    <span class="keyword">localparam</span>	IDLE 	= <span class="number">4&#x27;d0</span>,</span><br><span class="line">    			IN_1	= <span class="number">4&#x27;d1</span>,</span><br><span class="line">    			IN_2	= <span class="number">4&#x27;d2</span>,</span><br><span class="line">    			IN_3	= <span class="number">4&#x27;d3</span>,</span><br><span class="line">    			IN_4	= <span class="number">4&#x27;d4</span>,</span><br><span class="line">    			IN_5	= <span class="number">4&#x27;d5</span>,</span><br><span class="line">    			IN_6	= <span class="number">4&#x27;d6</span>,</span><br><span class="line">    			DONE	= <span class="number">4&#x27;d7</span>;</span><br><span class="line">    <span class="keyword">localparam</span>	MONEY_PAY	= <span class="number">4&#x27;d6</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">reg</span>[<span class="number">3</span>:<span class="number">0</span>] cstate,nstate;	</span><br><span class="line">    <span class="keyword">reg</span>[<span class="number">3</span>:<span class="number">0</span>] money_sum;		</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//时序逻辑，锁存状态</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">if</span>(!i_rst_n) </span><br><span class="line">            cstate &lt;= IDLE;</span><br><span class="line">    	<span class="keyword">else</span> </span><br><span class="line">            cstate &lt;= nstate;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//组合逻辑实现状态变迁</span></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">case</span>(cstate)</span><br><span class="line">    		IDLE: <span class="keyword">begin</span></span><br><span class="line">    			<span class="keyword">if</span>(i_1yuan || i_2yuan || i_5yuan) </span><br><span class="line">                    nstate = IN_1;</span><br><span class="line">    			<span class="keyword">else</span> </span><br><span class="line">                    nstate = IDLE;</span><br><span class="line">    		<span class="keyword">end</span></span><br><span class="line">    		IN_1: <span class="keyword">begin</span></span><br><span class="line">    			<span class="keyword">if</span>(i_1yuan || i_2yuan || i_5yuan) </span><br><span class="line">                    nstate = IN_2;</span><br><span class="line">    			<span class="keyword">else</span> </span><br><span class="line">                    nstate = IN_1;</span><br><span class="line">    		<span class="keyword">end</span>		</span><br><span class="line">    		IN_2: <span class="keyword">begin</span></span><br><span class="line">    			<span class="keyword">if</span>(money_sum &gt;= MONEY_PAY) </span><br><span class="line">                    nstate = DONE;</span><br><span class="line">    			<span class="keyword">else</span> <span class="keyword">if</span>(i_1yuan || i_2yuan || i_5yuan) </span><br><span class="line">                        nstate = IN_3;</span><br><span class="line">    			<span class="keyword">else</span> </span><br><span class="line">                    nstate = IN_2;</span><br><span class="line">    		<span class="keyword">end</span></span><br><span class="line">    		IN_3: <span class="keyword">begin</span></span><br><span class="line">    			<span class="keyword">if</span>(money_sum &gt;= MONEY_PAY) </span><br><span class="line">                    nstate = DONE;</span><br><span class="line">    			<span class="keyword">else</span> <span class="keyword">if</span>(i_1yuan || i_2yuan || i_5yuan) </span><br><span class="line">                    nstate = IN_4;</span><br><span class="line">    			<span class="keyword">else</span> </span><br><span class="line">                    nstate = IN_3;</span><br><span class="line">    		<span class="keyword">end</span></span><br><span class="line">    		IN_4: <span class="keyword">begin</span></span><br><span class="line">    			<span class="keyword">if</span>(money_sum &gt;= MONEY_PAY) </span><br><span class="line">                    nstate = DONE;</span><br><span class="line">    			<span class="keyword">else</span> <span class="keyword">if</span>(i_1yuan || i_2yuan || i_5yuan) </span><br><span class="line">                    nstate = IN_5;</span><br><span class="line">    			<span class="keyword">else</span> </span><br><span class="line">                    nstate = IN_4;</span><br><span class="line">    		<span class="keyword">end</span></span><br><span class="line">    		IN_5: <span class="keyword">begin</span></span><br><span class="line">    			<span class="keyword">if</span>(money_sum &gt;= MONEY_PAY) </span><br><span class="line">                    nstate = DONE;</span><br><span class="line">    			<span class="keyword">else</span> <span class="keyword">if</span>(i_1yuan || i_2yuan || i_5yuan) </span><br><span class="line">                    nstate = IN_6;</span><br><span class="line">    			<span class="keyword">else</span> </span><br><span class="line">                    nstate = IN_5;</span><br><span class="line">    		<span class="keyword">end</span></span><br><span class="line">    		IN_6: <span class="keyword">begin</span></span><br><span class="line">    			<span class="keyword">if</span>(money_sum &gt;= MONEY_PAY) </span><br><span class="line">                    nstate = DONE;</span><br><span class="line">    			<span class="keyword">else</span> <span class="keyword">if</span>(i_1yuan || i_2yuan || i_5yuan) </span><br><span class="line">                    nstate = DONE;</span><br><span class="line">    			<span class="keyword">else</span> </span><br><span class="line">                    nstate = IN_6;</span><br><span class="line">    		<span class="keyword">end</span></span><br><span class="line">    		DONE: nstate = IDLE;</span><br><span class="line">    		<span class="keyword">default</span>: nstate = IDLE;</span><br><span class="line">    	<span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//当前状态输入钱币的累加计算</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk)	<span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">if</span>(!i_rst_n) </span><br><span class="line">            money_sum &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">    		<span class="keyword">case</span>(cstate)</span><br><span class="line">    			DONE: money_sum &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    			<span class="keyword">default</span>: <span class="keyword">begin</span></span><br><span class="line">    				<span class="keyword">if</span>(i_1yuan) </span><br><span class="line">                        money_sum &lt;= money_sum+<span class="number">1</span>;</span><br><span class="line">    				<span class="keyword">else</span> <span class="keyword">if</span>(i_2yuan) </span><br><span class="line">                        money_sum &lt;= money_sum+<span class="number">2</span>;</span><br><span class="line">    				<span class="keyword">else</span> <span class="keyword">if</span>(i_5yuan) </span><br><span class="line">                        money_sum &lt;= money_sum+<span class="number">5</span>;</span><br><span class="line">    				<span class="keyword">else</span> </span><br><span class="line">                        money_sum &lt;= money_sum;</span><br><span class="line">    			<span class="keyword">end</span></span><br><span class="line">    		<span class="keyword">endcase</span></span><br><span class="line">    	<span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//状态机的输出赋值</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk)	<span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">if</span>(!i_rst_n) </span><br><span class="line">            o_done &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">else</span> <span class="keyword">if</span>(cstate == DONE) </span><br><span class="line">            o_done &lt;= <span class="number">&#x27;b1</span>;</span><br><span class="line">    	<span class="keyword">else</span> </span><br><span class="line">            o_done &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="3-Testbench-15"><a href="#3-Testbench-15" class="headerlink" title="3.Testbench"></a>3.Testbench</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> FSM_tb;</span><br><span class="line">    <span class="comment">////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//参数定义</span></span><br><span class="line">    <span class="meta">`<span class="keyword">define</span> CLK_PERIORD		10		</span><span class="comment">//时钟周期设置为10ns（100MHz）	</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//接口申明</span></span><br><span class="line">    <span class="keyword">reg</span> clk;</span><br><span class="line">    <span class="keyword">reg</span> rst_n;</span><br><span class="line">    <span class="keyword">reg</span> i_1yuan;</span><br><span class="line">    <span class="keyword">reg</span> i_2yuan;</span><br><span class="line">    <span class="keyword">reg</span> i_5yuan;</span><br><span class="line">    <span class="keyword">wire</span> o_done;</span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////////////////////////////	</span></span><br><span class="line">    <span class="comment">//对被测试的设计进行例化</span></span><br><span class="line">    FSM_design FSM_design_U1(</span><br><span class="line">    	<span class="variable">.i_clk</span>(clk),</span><br><span class="line">    	<span class="variable">.i_rst_n</span>(rst_n),</span><br><span class="line">    	<span class="variable">.i_1yuan</span>(i_1yuan),</span><br><span class="line">    	<span class="variable">.i_2yuan</span>(i_2yuan),</span><br><span class="line">    	<span class="variable">.i_5yuan</span>(i_5yuan),</span><br><span class="line">    	<span class="variable">.o_done</span>(o_done)</span><br><span class="line">        );	</span><br><span class="line">    </span><br><span class="line">    <span class="comment">////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//复位和时钟产生</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">    	clk &lt;= <span class="number">0</span>;</span><br><span class="line">    	rst_n &lt;= <span class="number">0</span>;</span><br><span class="line">    	#<span class="number">1000</span>;</span><br><span class="line">    	rst_n &lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">always</span> <span class="variable">#(`CLK_PERIORD/2)</span> clk = ~clk;	</span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//测试激励产生</span></span><br><span class="line">    <span class="keyword">integer</span> i;</span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">    	i_1yuan = <span class="number">0</span>;</span><br><span class="line">    	i_2yuan = <span class="number">0</span>;</span><br><span class="line">    	i_5yuan = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    	@(<span class="keyword">posedge</span> rst_n);	<span class="comment">//等待复位完成</span></span><br><span class="line">    </span><br><span class="line">    	@(<span class="keyword">posedge</span> clk);</span><br><span class="line">    </span><br><span class="line">    	<span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">20</span>; i=i+<span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">    		task_random_pay();</span><br><span class="line">    	<span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    	#<span class="number">5000</span>;</span><br><span class="line">    </span><br><span class="line">    	<span class="built_in">$stop</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">task</span> task_random_pay;</span><br><span class="line">        <span class="keyword">integer</span> random_data;</span><br><span class="line">    	<span class="keyword">begin</span></span><br><span class="line">    		#<span class="number">1000</span>;</span><br><span class="line">    		random_data = &#123;<span class="built_in">$random</span>&#125;%<span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    		@(<span class="keyword">posedge</span> clk);</span><br><span class="line">    		<span class="keyword">if</span>(random_data == <span class="number">0</span>) </span><br><span class="line">                i_1yuan &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">    		<span class="keyword">else</span> <span class="keyword">if</span>(random_data == <span class="number">1</span>) </span><br><span class="line">                i_2yuan &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">    		<span class="keyword">else</span> <span class="keyword">if</span>(random_data == <span class="number">2</span>) </span><br><span class="line">                i_5yuan &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">    		<span class="keyword">else</span> ;</span><br><span class="line">    </span><br><span class="line">    		@(<span class="keyword">posedge</span> clk);</span><br><span class="line">    		i_1yuan &lt;= <span class="number">0</span>;</span><br><span class="line">    		i_2yuan &lt;= <span class="number">0</span>;</span><br><span class="line">    		i_5yuan &lt;= <span class="number">0</span>;	</span><br><span class="line">    	<span class="keyword">end</span> </span><br><span class="line">    <span class="keyword">endtask</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">if</span>(i_1yuan) </span><br><span class="line">            <span class="built_in">$display</span>(<span class="string">&quot;Pay 1 yuan.&quot;</span>);</span><br><span class="line">    	<span class="keyword">else</span> <span class="keyword">if</span>(i_2yuan) </span><br><span class="line">            <span class="built_in">$display</span>(<span class="string">&quot;Pay 2 yuan.&quot;</span>);</span><br><span class="line">    	<span class="keyword">else</span> <span class="keyword">if</span>(i_5yuan) </span><br><span class="line">            <span class="built_in">$display</span>(<span class="string">&quot;Pay 5 yuan.&quot;</span>);</span><br><span class="line">    	<span class="keyword">else</span> <span class="keyword">if</span>(o_done) </span><br><span class="line">            <span class="built_in">$display</span>(<span class="string">&quot;Got you want.&quot;</span>);</span><br><span class="line">    	<span class="keyword">else</span> ;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="4-仿真结果-15"><a href="#4-仿真结果-15" class="headerlink" title="4.仿真结果"></a>4.仿真结果</h2><p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230206174427148.png" alt="image-20230206174427148"></p>
<hr>
<h1 id="串口指令帧解码设计"><a href="#串口指令帧解码设计" class="headerlink" title="串口指令帧解码设计"></a>串口指令帧解码设计</h1><ul>
<li><p>接收串口数据接收，串（8个1bit）转并（8bit）</p>
</li>
<li><p>译码串口（UART）命令帧，提取有效数据</p>
<ul>
<li>帧头（4个字节）：0xaa + 0x55 + 0xa5 + 0x5a</li>
<li>有效数据（10个字节）：beep_periord（4个字节）+ beep_high（4个字节）+ beep_num（2个字节）32bit/16bit传输时，高字节在前</li>
<li>帧尾（4个字节） ：0xcc + 0x33 + 0xc3 + 0x3c</li>
</ul>
</li>
<li><p>按照命令控制蜂鸣器</p>
</li>
</ul>
<h2 id="1-关键点-16"><a href="#1-关键点-16" class="headerlink" title="1.关键点"></a>1.关键点</h2><ul>
<li><p>UART</p>
<ul>
<li>UART（Universal Asynchronous Receiver/Transmitter），即通用异步收发，它的数据传输不需要时钟，只要两条信号线分别进行数据的收（RX）和发（TX）</li>
<li>收发双方首先需要约定好数据传输的速率（简单的讲就是约定好一个数据位传输的时间）和帧格式（即一帧的长短，一帧由哪些位组成，他们的功能都是什么</li>
</ul>
</li>
<li><p>串口（UART）协议：</p>
<ul>
<li>它由1个起始位（必须为0）、8个数据位（用户数据）、1个奇偶校验位（用于简单的纠错以保证传输可靠性）和1或2个停止位（必须为1）组成</li>
<li>除了奇偶校验位，其他三个部分都是必须的</li>
<li>当信号线空闲时，必须为高电平</li>
<li>要发起数据传输时，1个低电平的脉冲表示起始位，然后连续传输8个数据位和若干个高电平的停止位</li>
</ul>
<p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230206175550881.png" alt="image-20230206175550881"></p>
</li>
<li><p><strong>模块划分与接口定义</strong>：</p>
<p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/%E6%A8%A1%E5%9D%97%E5%88%92%E5%88%86%E4%B8%8E%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89.png" alt="模块划分与接口定义"></p>
</li>
<li><p><strong>串口数据串并转换模块时序分析</strong>：</p>
<p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/%E4%B8%B2%E5%8F%A3%E6%8E%A5%E6%94%B6%E4%B8%B2%E5%B9%B6%E8%BD%AC%E6%8D%A2%E6%97%B6%E5%BA%8F.png" alt="串口接收串并转换时序"></p>
</li>
<li><p><strong>指令译码模块的状态转换图</strong>：在状态的迁移过程中做判断</p>
<p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/%E8%AF%91%E7%A0%81%E6%A8%A1%E5%9D%97%E7%8A%B6%E6%80%81%E8%BD%AC%E6%8D%A2%E5%9B%BE.png" alt="译码模块状态转换图"></p>
</li>
</ul>
<h2 id="2-源代码-16"><a href="#2-源代码-16" class="headerlink" title="2.源代码"></a>2.源代码</h2><ul>
<li>顶层模块：uart_decoder_design.v</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> uart_decoder_design(</span><br><span class="line">	<span class="keyword">input</span> i_clk,</span><br><span class="line">	<span class="keyword">input</span> i_rst_n,</span><br><span class="line">	<span class="keyword">input</span> i_uart_rx,</span><br><span class="line">	<span class="keyword">output</span> o_pwm</span><br><span class="line">    );</span><br><span class="line">		</span><br><span class="line">    <span class="meta">`<span class="keyword">define</span> CLK_PERIORD		20		</span><span class="comment">//时钟周期设置为20ns（50MHz）	</span></span><br><span class="line">    <span class="keyword">parameter</span> UART_BPS_RATE = <span class="number">115200</span>;	<span class="comment">//串口波特率定义</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">wire</span> w_bps_en;</span><br><span class="line">    <span class="keyword">wire</span> w_bps_done;</span><br><span class="line">    <span class="keyword">wire</span> w_rx_en;</span><br><span class="line">    <span class="keyword">wire</span>[<span class="number">7</span>:<span class="number">0</span>] w_rx_data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">wire</span> w_beep_en;</span><br><span class="line">    <span class="keyword">wire</span>[<span class="number">31</span>:<span class="number">0</span>] w_beep_periord;</span><br><span class="line">    <span class="keyword">wire</span>[<span class="number">31</span>:<span class="number">0</span>] w_beep_high;</span><br><span class="line">    <span class="keyword">wire</span>[<span class="number">15</span>:<span class="number">0</span>] w_beep_num;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//串口波特率控制模块例化	</span></span><br><span class="line">    bps_design	#(</span><br><span class="line">    	<span class="variable">.UART_BPS_RATE</span>(UART_BPS_RATE),	<span class="comment">//串口波特率设置（&lt;=115200），单位：bps</span></span><br><span class="line">    	<span class="variable">.CLK_PERIORD</span>(`CLK_PERIORD)		<span class="comment">//时钟周期设置，单位：ns</span></span><br><span class="line">    ) uut_bps_design(</span><br><span class="line">    	<span class="variable">.i_clk</span>(i_clk),</span><br><span class="line">    	<span class="variable">.i_rst_n</span>(i_rst_n),</span><br><span class="line">    	<span class="variable">.i_bps_en</span>(w_bps_en),</span><br><span class="line">    	<span class="variable">.o_bps_done</span>(w_bps_done)</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//串口数据串并转换模块例化</span></span><br><span class="line">    s2p_design uut_s2p_design(</span><br><span class="line">    	<span class="variable">.i_clk</span>(i_clk),</span><br><span class="line">    	<span class="variable">.i_rst_n</span>(i_rst_n),</span><br><span class="line">    	<span class="variable">.i_uart_rx</span>(i_uart_rx),</span><br><span class="line">    	<span class="variable">.i_bps_done</span>(w_bps_done),	</span><br><span class="line">    	<span class="variable">.o_bps_en</span>(w_bps_en),</span><br><span class="line">    	<span class="variable">.o_rx_en</span>(w_rx_en),</span><br><span class="line">    	<span class="variable">.o_rx_data</span>(w_rx_data)</span><br><span class="line">        );	</span><br><span class="line">    </span><br><span class="line">    <span class="comment">////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//串口指令帧解码模块例化	</span></span><br><span class="line">    decoder_design uut_decoder_design(</span><br><span class="line">    	<span class="variable">.i_clk</span>(i_clk),</span><br><span class="line">    	<span class="variable">.i_rst_n</span>(i_rst_n),</span><br><span class="line">    	<span class="variable">.i_rx_en</span>(w_rx_en),</span><br><span class="line">    	<span class="variable">.i_rx_data</span>(w_rx_data),</span><br><span class="line">    	<span class="variable">.o_beep_en</span>(w_beep_en),</span><br><span class="line">    	<span class="variable">.o_beep_periord</span>(w_beep_periord),</span><br><span class="line">    	<span class="variable">.o_beep_high</span>(w_beep_high),</span><br><span class="line">    	<span class="variable">.o_beep_num</span>(w_beep_num)</span><br><span class="line">        );	</span><br><span class="line">    </span><br><span class="line">    <span class="comment">////////////////////////////////////////////////////	</span></span><br><span class="line">    <span class="comment">//PWM蜂鸣器控制模块例化</span></span><br><span class="line">    beep_design uut_beep_design(</span><br><span class="line">    	<span class="variable">.i_clk</span>(i_clk),</span><br><span class="line">    	<span class="variable">.i_rst_n</span>(i_rst_n),</span><br><span class="line">    	<span class="variable">.i_en</span>(w_beep_en),</span><br><span class="line">    	<span class="variable">.i_periord</span>(w_beep_periord),</span><br><span class="line">    	<span class="variable">.i_high</span>(w_beep_high),</span><br><span class="line">    	<span class="variable">.i_times</span>(w_beep_num),</span><br><span class="line">    	<span class="variable">.o_pwm</span>(o_pwm)</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<ul>
<li>子模块：bps_design.v</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> bps_design#(</span><br><span class="line">	<span class="keyword">parameter</span> UART_BPS_RATE	= <span class="number">115200</span>,	<span class="comment">//串口波特率设置（&lt;=115200），单位：bps</span></span><br><span class="line">	<span class="keyword">parameter</span> CLK_PERIORD	= <span class="number">20</span>		<span class="comment">//时钟周期设置，单位：ns</span></span><br><span class="line">)</span><br><span class="line">(</span><br><span class="line">	<span class="keyword">input</span> i_clk,</span><br><span class="line">	<span class="keyword">input</span> i_rst_n,</span><br><span class="line">	<span class="keyword">input</span> i_bps_en,</span><br><span class="line">	<span class="keyword">output</span> <span class="keyword">reg</span> o_bps_done</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">localparam</span> BPS_CNT_MAX = <span class="number">1000_000_000</span>/UART_BPS_RATE/CLK_PERIORD-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">localparam</span> BPS_CNT_HALF = BPS_CNT_MAX/<span class="number">2</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">reg</span>[<span class="number">15</span>:<span class="number">0</span>] r_bps_cnt;	</span><br><span class="line">    </span><br><span class="line">    <span class="comment">////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//波特率的分频计数</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">if</span>(!i_rst_n) </span><br><span class="line">            r_bps_cnt &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">else</span> <span class="keyword">if</span>(i_bps_en) <span class="keyword">begin</span></span><br><span class="line">    	    <span class="keyword">if</span>(r_bps_cnt &lt; BPS_CNT_MAX) </span><br><span class="line">                r_bps_cnt &lt;= r_bps_cnt+<span class="number">1</span>;</span><br><span class="line">    	    <span class="keyword">else</span> </span><br><span class="line">                r_bps_cnt &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">end</span></span><br><span class="line">    	<span class="keyword">else</span> </span><br><span class="line">            r_bps_cnt &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//产生o_bps_done信号</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">if</span>(r_bps_cnt == BPS_CNT_HALF) </span><br><span class="line">            o_bps_done &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">    	<span class="keyword">else</span> </span><br><span class="line">            o_bps_done &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<ul>
<li>子模块：s2p_design.v</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//串并转化模块</span></span><br><span class="line"><span class="keyword">module</span> s2p_design(</span><br><span class="line">	<span class="keyword">input</span> i_clk,</span><br><span class="line">	<span class="keyword">input</span> i_rst_n,</span><br><span class="line">	<span class="keyword">input</span> i_uart_rx,</span><br><span class="line">	<span class="keyword">input</span> i_bps_done,	</span><br><span class="line">	<span class="keyword">output</span> <span class="keyword">reg</span> o_bps_en,</span><br><span class="line">	<span class="keyword">output</span> <span class="keyword">reg</span> o_rx_en,</span><br><span class="line">	<span class="keyword">output</span> <span class="keyword">reg</span>[<span class="number">7</span>:<span class="number">0</span>] o_rx_data</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span>[<span class="number">3</span>:<span class="number">0</span>] r_bit_cnt;</span><br><span class="line">    <span class="keyword">reg</span>[<span class="number">7</span>:<span class="number">0</span>] r_rx_data;</span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//产生i_uart_rx信号的下降沿</span></span><br><span class="line">    <span class="keyword">reg</span>[<span class="number">1</span>:<span class="number">0</span>] r_uart_rx;</span><br><span class="line">    <span class="keyword">wire</span> neg_uart_rx;</span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">if</span>(!i_rst_n) </span><br><span class="line">            r_uart_rx &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">else</span> </span><br><span class="line">            r_uart_rx &lt;= &#123;r_uart_rx[<span class="number">0</span>],i_uart_rx&#125;;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">assign</span> neg_uart_rx = r_uart_rx[<span class="number">1</span>] &amp; ~r_uart_rx[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//产生波特率计数使能信号o_bps_en</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">if</span>(!i_rst_n) </span><br><span class="line">            o_bps_en &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">else</span> <span class="keyword">if</span>(neg_uart_rx &amp;&amp; !o_bps_en) </span><br><span class="line">            o_bps_en &lt;= <span class="number">&#x27;b1</span>;</span><br><span class="line">    	<span class="keyword">else</span> <span class="keyword">if</span>(i_bps_done &amp;&amp; (r_bit_cnt == <span class="number">4&#x27;d9</span>)) </span><br><span class="line">            o_bps_en &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">else</span> </span><br><span class="line">            o_bps_en &lt;= o_bps_en;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//i_uart_rx的数据位进行计数</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">if</span>(!i_rst_n) </span><br><span class="line">            r_bit_cnt &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">else</span> <span class="keyword">if</span>(!o_bps_en) </span><br><span class="line">            r_bit_cnt &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">else</span> <span class="keyword">if</span>(i_bps_done) </span><br><span class="line">            r_bit_cnt &lt;= r_bit_cnt+<span class="number">1</span>;</span><br><span class="line">    	<span class="keyword">else</span> </span><br><span class="line">            r_bit_cnt &lt;= r_bit_cnt;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//对i_uart_rx的有效数据进行串并转换的锁存</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">if</span>(!i_rst_n) </span><br><span class="line">            r_rx_data &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">else</span> <span class="keyword">if</span>(i_bps_done) <span class="keyword">begin</span></span><br><span class="line">    	    <span class="keyword">case</span>(r_bit_cnt)</span><br><span class="line">    	    	<span class="number">4&#x27;d1</span>: r_rx_data[<span class="number">0</span>] &lt;= i_uart_rx;</span><br><span class="line">    	    	<span class="number">4&#x27;d2</span>: r_rx_data[<span class="number">1</span>] &lt;= i_uart_rx;</span><br><span class="line">    	    	<span class="number">4&#x27;d3</span>: r_rx_data[<span class="number">2</span>] &lt;= i_uart_rx;</span><br><span class="line">    	    	<span class="number">4&#x27;d4</span>: r_rx_data[<span class="number">3</span>] &lt;= i_uart_rx;</span><br><span class="line">    	    	<span class="number">4&#x27;d5</span>: r_rx_data[<span class="number">4</span>] &lt;= i_uart_rx;</span><br><span class="line">    	    	<span class="number">4&#x27;d6</span>: r_rx_data[<span class="number">5</span>] &lt;= i_uart_rx;</span><br><span class="line">    	    	<span class="number">4&#x27;d7</span>: r_rx_data[<span class="number">6</span>] &lt;= i_uart_rx;</span><br><span class="line">    	    	<span class="number">4&#x27;d8</span>: r_rx_data[<span class="number">7</span>] &lt;= i_uart_rx;</span><br><span class="line">    	    	<span class="keyword">default</span>: ;</span><br><span class="line">    	    <span class="keyword">endcase</span></span><br><span class="line">    	<span class="keyword">end</span></span><br><span class="line">    	<span class="keyword">else</span> ;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//产生并行数据有效信号和并行数据锁存</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">if</span>(!i_rst_n) </span><br><span class="line">            o_rx_en &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">else</span> <span class="keyword">if</span>(i_bps_done &amp;&amp; (r_bit_cnt == <span class="number">4&#x27;d9</span>)) </span><br><span class="line">            o_rx_en &lt;= <span class="number">&#x27;b1</span>;</span><br><span class="line">    	<span class="keyword">else</span> </span><br><span class="line">            o_rx_en &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">if</span>(i_bps_done &amp;&amp; (r_bit_cnt == <span class="number">4&#x27;d9</span>)) </span><br><span class="line">            o_rx_data &lt;= r_rx_data;</span><br><span class="line">    	<span class="keyword">else</span> ;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<ul>
<li>子模块：beep_design.v</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> beep_design(</span><br><span class="line">	<span class="keyword">input</span> i_clk,	<span class="comment">//50MHz（20ns）时钟</span></span><br><span class="line">	<span class="keyword">input</span> i_rst_n,	<span class="comment">//复位</span></span><br><span class="line">	<span class="keyword">input</span> i_en,	<span class="comment">//使能</span></span><br><span class="line">	<span class="keyword">input</span>[<span class="number">31</span>:<span class="number">0</span>] i_periord,	<span class="comment">//PWM的周期</span></span><br><span class="line">	<span class="keyword">input</span>[<span class="number">31</span>:<span class="number">0</span>] i_high,	<span class="comment">//高电平时间</span></span><br><span class="line">	<span class="keyword">input</span>[<span class="number">15</span>:<span class="number">0</span>] i_times,	<span class="comment">//次数</span></span><br><span class="line">	<span class="keyword">output</span> <span class="keyword">reg</span> o_pwm		<span class="comment">//PWM信号</span></span><br><span class="line">    );</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">reg</span>[<span class="number">1</span>:<span class="number">0</span>] r_en;</span><br><span class="line">    <span class="keyword">wire</span> w_pos_en;</span><br><span class="line">    <span class="keyword">wire</span> w_end_en;</span><br><span class="line">    <span class="keyword">reg</span> r_cnt_en;	<span class="comment">//内部各个计数器工作的使能信号</span></span><br><span class="line">    <span class="keyword">reg</span>[<span class="number">31</span>:<span class="number">0</span>] r_pcnt;	<span class="comment">//周期计数器</span></span><br><span class="line">    <span class="keyword">reg</span>[<span class="number">15</span>:<span class="number">0</span>] r_tcnt;	<span class="comment">//周期次数的计数器</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//产生i_en的上升沿标志信号</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(!i_rst_n)</span><br><span class="line">            r_en &lt;= <span class="number">2&#x27;b00</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">    	    r_en &lt;= &#123;r_en[<span class="number">0</span>],i_en&#125;;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">assign</span> w_pos_en = ~r_en[<span class="number">1</span>] &amp; r_en[<span class="number">0</span>];	</span><br><span class="line"></span><br><span class="line">    <span class="comment">/////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//产生内部PWM结束信号</span></span><br><span class="line">    <span class="keyword">assign</span> w_end_en = (r_pcnt == (i_periord-<span class="number">1</span>)) &amp;&amp; (r_tcnt == (i_times-<span class="number">1</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//产生内部各个计数器工作的是能信号</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">if</span>(!i_rst_n) </span><br><span class="line">            r_cnt_en &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">else</span> <span class="keyword">if</span>(w_pos_en) </span><br><span class="line">            r_cnt_en &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">    	<span class="keyword">else</span> <span class="keyword">if</span>(w_end_en) </span><br><span class="line">            r_cnt_en &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">else</span> </span><br><span class="line">            r_cnt_en &lt;= r_cnt_en;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//周期计数</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">if</span>(!r_cnt_en) </span><br><span class="line">            r_pcnt &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">else</span> <span class="keyword">if</span>(r_pcnt &lt; (i_periord-<span class="number">1</span>)) </span><br><span class="line">            r_pcnt &lt;= r_pcnt+<span class="number">1</span>;</span><br><span class="line">    	<span class="keyword">else</span> </span><br><span class="line">            r_pcnt &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//周期次数计数	</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">if</span>(!r_cnt_en) </span><br><span class="line">            r_tcnt &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">else</span> <span class="keyword">if</span>(r_pcnt == (i_periord-<span class="number">1</span>)) </span><br><span class="line">            r_tcnt &lt;= r_tcnt+<span class="number">1</span>;</span><br><span class="line">    	<span class="keyword">else</span> </span><br><span class="line">            r_tcnt &lt;= r_tcnt;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//输出PWM波形</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">if</span>(!i_rst_n) </span><br><span class="line">            o_pwm &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">else</span> <span class="keyword">if</span>((r_pcnt &gt; <span class="number">32&#x27;d0</span>) &amp;&amp; (r_pcnt &lt;= i_high)) </span><br><span class="line">            o_pwm &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">    	<span class="keyword">else</span> </span><br><span class="line">            o_pwm &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<ul>
<li>子模块：decoder_design.v</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> decoder_design(</span><br><span class="line">	<span class="keyword">input</span> i_clk,</span><br><span class="line">	<span class="keyword">input</span> i_rst_n,</span><br><span class="line">	<span class="keyword">input</span> i_rx_en,</span><br><span class="line">	<span class="keyword">input</span>[<span class="number">7</span>:<span class="number">0</span>] i_rx_data,</span><br><span class="line">	<span class="keyword">output</span> <span class="keyword">reg</span> o_beep_en,</span><br><span class="line">	<span class="keyword">output</span> <span class="keyword">reg</span>[<span class="number">31</span>:<span class="number">0</span>] o_beep_periord,</span><br><span class="line">	<span class="keyword">output</span> <span class="keyword">reg</span>[<span class="number">31</span>:<span class="number">0</span>] o_beep_high,</span><br><span class="line">	<span class="keyword">output</span> <span class="keyword">reg</span>[<span class="number">15</span>:<span class="number">0</span>] o_beep_num</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">//帧头</span></span><br><span class="line">    <span class="keyword">localparam</span> DATA_SOF1	= <span class="number">8&#x27;haa</span>;	</span><br><span class="line">    <span class="keyword">localparam</span> DATA_SOF2	= <span class="number">8&#x27;h55</span>;</span><br><span class="line">    <span class="keyword">localparam</span> DATA_SOF3	= <span class="number">8&#x27;ha5</span>;</span><br><span class="line">    <span class="keyword">localparam</span> DATA_SOF4	= <span class="number">8&#x27;h5a</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//帧尾</span></span><br><span class="line">    <span class="keyword">localparam</span> DATA_EOF1	= <span class="number">8&#x27;hcc</span>;	</span><br><span class="line">    <span class="keyword">localparam</span> DATA_EOF2	= <span class="number">8&#x27;h33</span>;</span><br><span class="line">    <span class="keyword">localparam</span> DATA_EOF3	= <span class="number">8&#x27;hc3</span>;</span><br><span class="line">    <span class="keyword">localparam</span> DATA_EOF4	= <span class="number">8&#x27;h3c</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//状态</span></span><br><span class="line">    <span class="keyword">localparam</span> IDLE	= <span class="number">4&#x27;d0</span>;		</span><br><span class="line">    <span class="keyword">localparam</span> SOF1	= <span class="number">4&#x27;d1</span>;	</span><br><span class="line">    <span class="keyword">localparam</span> SOF2	= <span class="number">4&#x27;d2</span>;</span><br><span class="line">    <span class="keyword">localparam</span> SOF3	= <span class="number">4&#x27;d3</span>;</span><br><span class="line">    <span class="keyword">localparam</span> RXDB = <span class="number">4&#x27;d4</span>;           </span><br><span class="line">    <span class="keyword">localparam</span> EOF1	= <span class="number">4&#x27;d5</span>;	</span><br><span class="line">    <span class="keyword">localparam</span> EOF2	= <span class="number">4&#x27;d6</span>;</span><br><span class="line">    <span class="keyword">localparam</span> EOF3	= <span class="number">4&#x27;d7</span>;</span><br><span class="line">    <span class="keyword">localparam</span> EOF4	= <span class="number">4&#x27;d8</span>;</span><br><span class="line">    <span class="keyword">localparam</span> DONE	= <span class="number">4&#x27;d9</span>;	</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span>[<span class="number">3</span>:<span class="number">0</span>] r_cstate,r_nstate;</span><br><span class="line">    <span class="keyword">reg</span>[<span class="number">3</span>:<span class="number">0</span>] r_bytecnt;</span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//时序逻辑状态切换</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">if</span>(!i_rst_n) </span><br><span class="line">            r_cstate &lt;= IDLE;</span><br><span class="line">    	<span class="keyword">else</span> </span><br><span class="line">            r_cstate &lt;= r_nstate;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//组合逻辑切换状态</span></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">case</span>(r_cstate)</span><br><span class="line">    		IDLE: <span class="keyword">begin</span></span><br><span class="line">    			<span class="keyword">if</span>(i_rx_en) <span class="keyword">begin</span></span><br><span class="line">    				<span class="keyword">if</span>(i_rx_data == DATA_SOF1) </span><br><span class="line">                        r_nstate = SOF1;</span><br><span class="line">    				<span class="keyword">else</span> </span><br><span class="line">                        r_nstate = IDLE;</span><br><span class="line">    			<span class="keyword">end</span></span><br><span class="line">    			<span class="keyword">else</span> </span><br><span class="line">                    r_nstate = IDLE;</span><br><span class="line">    		<span class="keyword">end</span></span><br><span class="line">    		SOF1: <span class="keyword">begin</span></span><br><span class="line">    			<span class="keyword">if</span>(i_rx_en) <span class="keyword">begin</span></span><br><span class="line">    				<span class="keyword">if</span>(i_rx_data == DATA_SOF2) </span><br><span class="line">                        r_nstate = SOF2;</span><br><span class="line">    				<span class="keyword">else</span> </span><br><span class="line">                        r_nstate = IDLE;</span><br><span class="line">    			<span class="keyword">end</span></span><br><span class="line">    			<span class="keyword">else</span> </span><br><span class="line">                    r_nstate = SOF1;</span><br><span class="line">    		<span class="keyword">end</span></span><br><span class="line">    		SOF2: <span class="keyword">begin</span></span><br><span class="line">    			<span class="keyword">if</span>(i_rx_en) <span class="keyword">begin</span></span><br><span class="line">    				<span class="keyword">if</span>(i_rx_data == DATA_SOF3) </span><br><span class="line">                        r_nstate = SOF3;</span><br><span class="line">    				<span class="keyword">else</span> </span><br><span class="line">                        r_nstate = IDLE;</span><br><span class="line">    			<span class="keyword">end</span></span><br><span class="line">    			<span class="keyword">else</span> </span><br><span class="line">                    r_nstate = SOF2;</span><br><span class="line">    		<span class="keyword">end</span>		</span><br><span class="line">    		SOF3: <span class="keyword">begin</span></span><br><span class="line">    			<span class="keyword">if</span>(i_rx_en) <span class="keyword">begin</span></span><br><span class="line">    				<span class="keyword">if</span>(i_rx_data == DATA_SOF4) </span><br><span class="line">                        r_nstate = RXDB;</span><br><span class="line">    				<span class="keyword">else</span> </span><br><span class="line">                        r_nstate = IDLE;</span><br><span class="line">    			<span class="keyword">end</span></span><br><span class="line">    			<span class="keyword">else</span> </span><br><span class="line">                    r_nstate = SOF3;</span><br><span class="line">    		<span class="keyword">end</span>	</span><br><span class="line"></span><br><span class="line">    		RXDB: <span class="keyword">begin</span></span><br><span class="line">    			<span class="keyword">if</span>(i_rx_en) <span class="keyword">begin</span></span><br><span class="line">    				<span class="keyword">if</span>(r_bytecnt &gt;= <span class="number">4&#x27;d9</span>) </span><br><span class="line">                        r_nstate = EOF1;</span><br><span class="line">    				<span class="keyword">else</span> </span><br><span class="line">                        r_nstate = RXDB;</span><br><span class="line">    			<span class="keyword">end</span></span><br><span class="line">    			<span class="keyword">else</span> </span><br><span class="line">                    r_nstate = RXDB;</span><br><span class="line">    		<span class="keyword">end</span>	</span><br><span class="line">    </span><br><span class="line">    		EOF1: <span class="keyword">begin</span></span><br><span class="line">    			<span class="keyword">if</span>(i_rx_en) <span class="keyword">begin</span></span><br><span class="line">    				<span class="keyword">if</span>(i_rx_data == DATA_EOF1) </span><br><span class="line">                        r_nstate = EOF2;</span><br><span class="line">    				<span class="keyword">else</span> </span><br><span class="line">                        r_nstate = IDLE;			</span><br><span class="line">    			<span class="keyword">end</span></span><br><span class="line">    			<span class="keyword">else</span> </span><br><span class="line">                    r_nstate = EOF1;</span><br><span class="line">    		<span class="keyword">end</span>	</span><br><span class="line">    		EOF2: <span class="keyword">begin</span></span><br><span class="line">    			<span class="keyword">if</span>(i_rx_en) <span class="keyword">begin</span></span><br><span class="line">    				<span class="keyword">if</span>(i_rx_data == DATA_EOF2) </span><br><span class="line">                        r_nstate = EOF3;</span><br><span class="line">    				<span class="keyword">else</span> </span><br><span class="line">                        r_nstate = IDLE;			</span><br><span class="line">    			<span class="keyword">end</span></span><br><span class="line">    			<span class="keyword">else</span> </span><br><span class="line">                    r_nstate = EOF2;</span><br><span class="line">    		<span class="keyword">end</span>	</span><br><span class="line">    		EOF3: <span class="keyword">begin</span></span><br><span class="line">    			<span class="keyword">if</span>(i_rx_en) <span class="keyword">begin</span></span><br><span class="line">    				<span class="keyword">if</span>(i_rx_data == DATA_EOF3) </span><br><span class="line">                        r_nstate = EOF4;</span><br><span class="line">    				<span class="keyword">else</span> </span><br><span class="line">                        r_nstate = IDLE;			</span><br><span class="line">    			<span class="keyword">end</span></span><br><span class="line">    			<span class="keyword">else</span> </span><br><span class="line">                    r_nstate = EOF3;</span><br><span class="line">    		<span class="keyword">end</span>			</span><br><span class="line">    		EOF4: <span class="keyword">begin</span></span><br><span class="line">    			<span class="keyword">if</span>(i_rx_en) <span class="keyword">begin</span></span><br><span class="line">    				<span class="keyword">if</span>(i_rx_data == DATA_EOF4) </span><br><span class="line">                        r_nstate = DONE;</span><br><span class="line">    				<span class="keyword">else</span> </span><br><span class="line">                        r_nstate = IDLE;			</span><br><span class="line">    			<span class="keyword">end</span></span><br><span class="line">    			<span class="keyword">else</span> </span><br><span class="line">                    r_nstate = EOF4;</span><br><span class="line">    		<span class="keyword">end</span>	</span><br><span class="line"></span><br><span class="line">    		DONE: r_nstate = IDLE;</span><br><span class="line">    		<span class="keyword">default</span>: ;</span><br><span class="line">    	<span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//对10个有效数据字节进行计数</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">if</span>(r_cstate == RXDB) <span class="keyword">begin</span></span><br><span class="line">    		<span class="keyword">if</span>(i_rx_en) </span><br><span class="line">                r_bytecnt &lt;= r_bytecnt+<span class="number">1</span>;</span><br><span class="line">    		<span class="keyword">else</span> </span><br><span class="line">                r_bytecnt &lt;= r_bytecnt;</span><br><span class="line">    	<span class="keyword">end</span></span><br><span class="line">    	<span class="keyword">else</span> </span><br><span class="line">            r_bytecnt &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//对有效数据进行锁存（采集）</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk) <span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">if</span>((r_cstate == RXDB) &amp;&amp; i_rx_en) <span class="keyword">begin</span></span><br><span class="line">    		<span class="keyword">case</span>(r_bytecnt)</span><br><span class="line">    			<span class="number">4&#x27;d0</span>: o_beep_periord[<span class="number">31</span>:<span class="number">24</span>] &lt;= i_rx_data;</span><br><span class="line">    			<span class="number">4&#x27;d1</span>: o_beep_periord[<span class="number">23</span>:<span class="number">16</span>] &lt;= i_rx_data;</span><br><span class="line">    			<span class="number">4&#x27;d2</span>: o_beep_periord[<span class="number">15</span>:<span class="number">8</span>] &lt;= i_rx_data;</span><br><span class="line">    			<span class="number">4&#x27;d3</span>: o_beep_periord[<span class="number">7</span>:<span class="number">0</span>] &lt;= i_rx_data;</span><br><span class="line">    </span><br><span class="line">    			<span class="number">4&#x27;d4</span>: o_beep_high[<span class="number">31</span>:<span class="number">24</span>] &lt;= i_rx_data;</span><br><span class="line">    			<span class="number">4&#x27;d5</span>: o_beep_high[<span class="number">23</span>:<span class="number">16</span>] &lt;= i_rx_data;</span><br><span class="line">    			<span class="number">4&#x27;d6</span>: o_beep_high[<span class="number">15</span>:<span class="number">8</span>] &lt;= i_rx_data;</span><br><span class="line">    			<span class="number">4&#x27;d7</span>: o_beep_high[<span class="number">7</span>:<span class="number">0</span>] &lt;= i_rx_data;</span><br><span class="line"></span><br><span class="line">    			<span class="number">4&#x27;d8</span>: o_beep_num[<span class="number">15</span>:<span class="number">8</span>] &lt;= i_rx_data;</span><br><span class="line">    			<span class="number">4&#x27;d9</span>: o_beep_num[<span class="number">7</span>:<span class="number">0</span>] &lt;= i_rx_data;			</span><br><span class="line">    			<span class="keyword">default</span>: ;</span><br><span class="line">    		<span class="keyword">endcase</span></span><br><span class="line">    	<span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//有效数据使能信号产生</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> i_clk)	<span class="keyword">begin</span></span><br><span class="line">    	<span class="keyword">if</span>(!i_rst_n) </span><br><span class="line">            o_beep_en &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    	<span class="keyword">else</span> <span class="keyword">if</span>(r_cstate == DONE) </span><br><span class="line">            o_beep_en &lt;= <span class="number">&#x27;b1</span>;</span><br><span class="line">    	<span class="keyword">else</span> </span><br><span class="line">            o_beep_en &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="3-Testbench-16"><a href="#3-Testbench-16" class="headerlink" title="3.Testbench"></a>3.Testbench</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> uart_decoder_tb;</span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//参数定义</span></span><br><span class="line">    <span class="meta">`<span class="keyword">define</span> CLK_PERIORD		20		</span><span class="comment">//时钟周期设置为20ns（50MHz）	</span></span><br><span class="line">    <span class="keyword">parameter</span> UART_BPS_RATE = <span class="number">115200</span>;</span><br><span class="line">    <span class="keyword">parameter</span> BPS_DLY_BIT	= <span class="number">1000000000</span>/UART_BPS_RATE;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//接口申明</span></span><br><span class="line">    <span class="keyword">reg</span> i_clk;</span><br><span class="line">    <span class="keyword">reg</span> i_rst_n;</span><br><span class="line">    <span class="keyword">reg</span> i_uart_rx;</span><br><span class="line">    <span class="keyword">wire</span> o_pwm;</span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////////////////////////////	</span></span><br><span class="line">    <span class="comment">//对被测试的设计进行例化</span></span><br><span class="line">    uart_decoder_design	uut_uart_decoder_design(</span><br><span class="line">    	<span class="variable">.i_clk</span>(i_clk),</span><br><span class="line">    	<span class="variable">.i_rst_n</span>(i_rst_n),</span><br><span class="line">    	<span class="variable">.i_uart_rx</span>(i_uart_rx),</span><br><span class="line">    	<span class="variable">.o_pwm</span>(o_pwm)</span><br><span class="line">        );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//复位和时钟产生</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">    	i_clk &lt;= <span class="number">0</span>;</span><br><span class="line">    	i_rst_n &lt;= <span class="number">0</span>;</span><br><span class="line">    	#<span class="number">1000</span>;</span><br><span class="line">    	i_rst_n &lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">always</span> <span class="variable">#(`CLK_PERIORD/2)</span> i_clk &lt;= ~i_clk;	</span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//测试激励产生</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">    	i_uart_rx &lt;= <span class="number">&#x27;b1</span>;</span><br><span class="line">    	@(<span class="keyword">posedge</span> i_rst_n);	<span class="comment">//等待复位完成</span></span><br><span class="line">    </span><br><span class="line">    	@(<span class="keyword">posedge</span> i_clk);</span><br><span class="line">    </span><br><span class="line">    	#<span class="number">100_000</span>;</span><br><span class="line">    	task_cmd_tx(<span class="number">32&#x27;d1000</span>,<span class="number">32&#x27;d100</span>,<span class="number">16&#x27;d5</span>);</span><br><span class="line">    </span><br><span class="line">    	#<span class="number">1_000_000</span>;</span><br><span class="line">    	task_cmd_tx(<span class="number">32&#x27;d5000</span>,<span class="number">32&#x27;d1000</span>,<span class="number">16&#x27;d6</span>);	</span><br><span class="line"></span><br><span class="line">    	#<span class="number">1_000_000</span>;	</span><br><span class="line">    	<span class="built_in">$stop</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">integer</span> i;</span><br><span class="line">    <span class="comment">//模拟传输一个byte的任务</span></span><br><span class="line">    <span class="keyword">task</span> task_uart_tx;</span><br><span class="line">    	<span class="keyword">input</span>[<span class="number">7</span>:<span class="number">0</span>] tx_db;</span><br><span class="line">    	<span class="keyword">begin</span></span><br><span class="line">    		i_uart_rx &lt;= <span class="number">&#x27;b0</span>;</span><br><span class="line">    		#BPS_DLY_BIT;</span><br><span class="line">    		<span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">8</span>; i=i+<span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">    			i_uart_rx &lt;= tx_db[i];</span><br><span class="line">    			#BPS_DLY_BIT;</span><br><span class="line">    		<span class="keyword">end</span></span><br><span class="line">    		i_uart_rx &lt;= <span class="number">&#x27;b1</span>;</span><br><span class="line">    		#BPS_DLY_BIT;</span><br><span class="line">    	<span class="keyword">end</span></span><br><span class="line">    <span class="keyword">endtask</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//模拟一次完整的UART命令帧</span></span><br><span class="line">    <span class="keyword">task</span> task_cmd_tx;</span><br><span class="line">    	<span class="keyword">input</span>[<span class="number">31</span>:<span class="number">0</span>] tx_beep_periord;</span><br><span class="line">    	<span class="keyword">input</span>[<span class="number">31</span>:<span class="number">0</span>] tx_beep_high;</span><br><span class="line">    	<span class="keyword">input</span>[<span class="number">15</span>:<span class="number">0</span>] tx_beep_num;</span><br><span class="line">    	<span class="keyword">begin</span></span><br><span class="line">    		task_uart_tx(<span class="number">8&#x27;haa</span>);</span><br><span class="line">    		task_uart_tx(<span class="number">8&#x27;h55</span>);</span><br><span class="line">    		task_uart_tx(<span class="number">8&#x27;ha5</span>);</span><br><span class="line">    		task_uart_tx(<span class="number">8&#x27;h5a</span>);</span><br><span class="line">    </span><br><span class="line">    		task_uart_tx(tx_beep_periord[<span class="number">31</span>:<span class="number">24</span>]);</span><br><span class="line">    		task_uart_tx(tx_beep_periord[<span class="number">23</span>:<span class="number">16</span>]);</span><br><span class="line">    		task_uart_tx(tx_beep_periord[<span class="number">15</span>:<span class="number">8</span>]);</span><br><span class="line">    		task_uart_tx(tx_beep_periord[<span class="number">7</span>:<span class="number">0</span>]);	</span><br><span class="line">    </span><br><span class="line">    		task_uart_tx(tx_beep_high[<span class="number">31</span>:<span class="number">24</span>]);</span><br><span class="line">    		task_uart_tx(tx_beep_high[<span class="number">23</span>:<span class="number">16</span>]);</span><br><span class="line">    		task_uart_tx(tx_beep_high[<span class="number">15</span>:<span class="number">8</span>]);</span><br><span class="line">    		task_uart_tx(tx_beep_high[<span class="number">7</span>:<span class="number">0</span>]);			</span><br><span class="line"></span><br><span class="line">    		task_uart_tx(tx_beep_num[<span class="number">15</span>:<span class="number">8</span>]);</span><br><span class="line">    		task_uart_tx(tx_beep_num[<span class="number">7</span>:<span class="number">0</span>]);</span><br><span class="line">    </span><br><span class="line">    		task_uart_tx(<span class="number">8&#x27;hcc</span>);</span><br><span class="line">    		task_uart_tx(<span class="number">8&#x27;h33</span>);</span><br><span class="line">    		task_uart_tx(<span class="number">8&#x27;hc3</span>);</span><br><span class="line">    		task_uart_tx(<span class="number">8&#x27;h3c</span>);		</span><br><span class="line">    	<span class="keyword">end</span></span><br><span class="line">    <span class="keyword">endtask</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="4-仿真结果-16"><a href="#4-仿真结果-16" class="headerlink" title="4.仿真结果"></a>4.仿真结果</h2><ul>
<li>RTL视图</li>
</ul>
<p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230206210526508.png" alt="image-20230206210526508"></p>
<ul>
<li>仿真波形</li>
</ul>
<p><img src="/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/image-20230206211033267.png" alt="image-20230206211033267"></p>
<hr>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Ve411x75W/?spm_id_from=333.337.search-card.all.click&vd_source=221b76534ba13cfad544149d75ce9b6c">特权同学《Verilog边码边学》基于Xilinx FPGA的Verilog编码、仿真与调试基础教程_哔哩哔哩_bilibili</a></li>
</ul>

    </div>

    
    
    
        <div class="reward-container">
  <div>欢迎来到ssy的世界</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/WeChaPay.jpg" alt="ssy 微信支付">
        <p>微信支付</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>ssy
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://ssy的小天地.com/2023/01/05/Verilog%E4%B9%8B%E8%BE%B9%E7%A0%81%E8%BE%B9%E5%AD%A6/" title="Verilog之边码边学">http://ssy的小天地.com/2023/01/05/Verilog之边码边学/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Verilog/" rel="tag"># Verilog</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/01/01/%E6%97%A5%E5%B8%B8%E5%88%86%E4%BA%AB2023/" rel="prev" title="小沈同学的日常分享2023">
      <i class="fa fa-chevron-left"></i> 小沈同学的日常分享2023
    </a></div>
      <div class="post-nav-item">
    <a href="/2023/01/05/Verilog%E4%B9%8B%E7%94%B1%E6%B5%85%E5%85%A5%E6%B7%B1%E5%AD%A6%E4%B9%A0/" rel="next" title="Verilog之由浅入深学习">
      Verilog之由浅入深学习 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%86%E9%A2%91%E8%AE%A1%E6%95%B0%E5%99%A8%E8%AE%BE%E8%AE%A1"><span class="nav-number">1.</span> <span class="nav-text">分频计数器设计</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%85%B3%E9%94%AE%E7%82%B9"><span class="nav-number">1.1.</span> <span class="nav-text">1.关键点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%BA%90%E4%BB%A3%E7%A0%81"><span class="nav-number">1.2.</span> <span class="nav-text">2.源代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Testbench"><span class="nav-number">1.3.</span> <span class="nav-text">3.Testbench</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E4%BB%BF%E7%9C%9F%E7%BB%93%E6%9E%9C"><span class="nav-number">1.4.</span> <span class="nav-text">4.仿真结果</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%BF%E8%83%BD%E6%97%B6%E9%92%9F%E8%AE%BE%E8%AE%A1"><span class="nav-number">2.</span> <span class="nav-text">使能时钟设计</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%85%B3%E9%94%AE%E7%82%B9-1"><span class="nav-number">2.1.</span> <span class="nav-text">1.关键点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%BA%90%E4%BB%A3%E7%A0%81-1"><span class="nav-number">2.2.</span> <span class="nav-text">2.源代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Testbench-1"><span class="nav-number">2.3.</span> <span class="nav-text">3.Testbench</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E4%BB%BF%E7%9C%9F%E7%BB%93%E6%9E%9C-1"><span class="nav-number">2.4.</span> <span class="nav-text">4.仿真结果</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8EXlinx-BUFGCE%E5%8E%9F%E8%AF%AD%E7%9A%84%E9%97%A8%E6%8E%A7%E6%97%B6%E9%92%9F%E8%AE%BE%E8%AE%A1"><span class="nav-number">3.</span> <span class="nav-text">基于Xlinx BUFGCE原语的门控时钟设计</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%85%B3%E9%94%AE%E7%82%B9-2"><span class="nav-number">3.1.</span> <span class="nav-text">1.关键点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%BA%90%E4%BB%A3%E7%A0%81-2"><span class="nav-number">3.2.</span> <span class="nav-text">2.源代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Testbench-2"><span class="nav-number">3.3.</span> <span class="nav-text">3.Testbench</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E4%BB%BF%E7%9C%9F%E7%BB%93%E6%9E%9C-2"><span class="nav-number">3.4.</span> <span class="nav-text">4.仿真结果</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%90%8C%E6%AD%A5%E5%A4%8D%E4%BD%8D%E4%B8%8E%E5%BC%82%E6%AD%A5%E5%A4%8D%E4%BD%8D"><span class="nav-number">4.</span> <span class="nav-text">同步复位与异步复位</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%85%B3%E9%94%AE%E7%82%B9-3"><span class="nav-number">4.1.</span> <span class="nav-text">1.关键点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%BA%90%E4%BB%A3%E7%A0%81-3"><span class="nav-number">4.2.</span> <span class="nav-text">2.源代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Testbench-3"><span class="nav-number">4.3.</span> <span class="nav-text">3.Testbench</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E4%BB%BF%E7%9C%9F%E7%BB%93%E6%9E%9C-3"><span class="nav-number">4.4.</span> <span class="nav-text">4.仿真结果</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%84%89%E5%86%B2%E8%BE%B9%E6%B2%BF%E6%A3%80%E6%B5%8B"><span class="nav-number">5.</span> <span class="nav-text">脉冲边沿检测</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%85%B3%E9%94%AE%E7%82%B9-4"><span class="nav-number">5.1.</span> <span class="nav-text">1.关键点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%BA%90%E4%BB%A3%E7%A0%81-4"><span class="nav-number">5.2.</span> <span class="nav-text">2.源代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Testbench-4"><span class="nav-number">5.3.</span> <span class="nav-text">3.Testbench</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E4%BB%BF%E7%9C%9F%E7%BB%93%E6%9E%9C-4"><span class="nav-number">5.4.</span> <span class="nav-text">4.仿真结果</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%84%89%E5%86%B2%E8%AE%A1%E6%95%B0%E5%99%A8"><span class="nav-number">6.</span> <span class="nav-text">脉冲计数器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E6%BA%90%E4%BB%A3%E7%A0%81"><span class="nav-number">6.1.</span> <span class="nav-text">1.源代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Testbench"><span class="nav-number">6.2.</span> <span class="nav-text">2.Testbench</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E4%BB%BF%E7%9C%9F%E7%BB%93%E6%9E%9C"><span class="nav-number">6.3.</span> <span class="nav-text">3.仿真结果</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#generate%E8%AF%AD%E6%B3%95%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">7.</span> <span class="nav-text">generate语法的使用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%85%B3%E9%94%AE%E7%82%B9-5"><span class="nav-number">7.1.</span> <span class="nav-text">1.关键点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%BA%90%E4%BB%A3%E7%A0%81-5"><span class="nav-number">7.2.</span> <span class="nav-text">2.源代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Testbench-5"><span class="nav-number">7.3.</span> <span class="nav-text">3.Testbench</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E4%BB%BF%E7%9C%9F%E7%BB%93%E6%9E%9C-5"><span class="nav-number">7.4.</span> <span class="nav-text">4.仿真结果</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%A2%91%E7%8E%87%E8%AE%A1%E6%95%B0%E5%99%A8"><span class="nav-number">8.</span> <span class="nav-text">频率计数器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%85%B3%E9%94%AE%E7%82%B9-6"><span class="nav-number">8.1.</span> <span class="nav-text">1.关键点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%BA%90%E4%BB%A3%E7%A0%81-6"><span class="nav-number">8.2.</span> <span class="nav-text">2.源代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Testbench-6"><span class="nav-number">8.3.</span> <span class="nav-text">3.Testbench</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E4%BB%BF%E7%9C%9F%E7%BB%93%E6%9E%9C-6"><span class="nav-number">8.4.</span> <span class="nav-text">4.仿真结果</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4%E4%BD%8D%E6%A0%BC%E9%9B%B7%E7%A0%81%E8%AE%A1%E6%95%B0%E5%99%A8"><span class="nav-number">9.</span> <span class="nav-text">4位格雷码计数器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%85%B3%E9%94%AE%E7%82%B9-7"><span class="nav-number">9.1.</span> <span class="nav-text">1.关键点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%BA%90%E4%BB%A3%E7%A0%81-7"><span class="nav-number">9.2.</span> <span class="nav-text">2.源代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Testbench-7"><span class="nav-number">9.3.</span> <span class="nav-text">3.Testbench</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E4%BB%BF%E7%9C%9F%E7%BB%93%E6%9E%9C-7"><span class="nav-number">9.4.</span> <span class="nav-text">4.仿真结果</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E6%9F%A5%E6%89%BE%E8%A1%A8%E7%9A%848%E4%BD%8D%E6%A0%BC%E9%9B%B7%E7%A0%81%E8%BD%AC%E6%8D%A2"><span class="nav-number">10.</span> <span class="nav-text">基于查找表的8位格雷码转换</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%85%B3%E9%94%AE%E7%82%B9-8"><span class="nav-number">10.1.</span> <span class="nav-text">1.关键点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%BA%90%E4%BB%A3%E7%A0%81-8"><span class="nav-number">10.2.</span> <span class="nav-text">2.源代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Testbench-8"><span class="nav-number">10.3.</span> <span class="nav-text">3.Testbench</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E4%BB%BF%E7%9C%9F%E7%BB%93%E6%9E%9C-8"><span class="nav-number">10.4.</span> <span class="nav-text">4.仿真结果</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%A0%BC%E9%9B%B7%E7%A0%81%E8%BD%AC%E6%8D%A2%E7%9A%84%E5%BF%AB%E9%80%9F%E7%AE%97%E6%B3%95"><span class="nav-number">11.</span> <span class="nav-text">格雷码转换的快速算法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%85%B3%E9%94%AE%E7%82%B9-9"><span class="nav-number">11.1.</span> <span class="nav-text">1.关键点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%BA%90%E4%BB%A3%E7%A0%81-9"><span class="nav-number">11.2.</span> <span class="nav-text">2.源代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Testbench-9"><span class="nav-number">11.3.</span> <span class="nav-text">3.Testbench</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E4%BB%BF%E7%9C%9F%E7%BB%93%E6%9E%9C-9"><span class="nav-number">11.4.</span> <span class="nav-text">4.仿真结果</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Testbench%E4%B8%AD%E6%96%87%E6%9C%AC%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%E6%93%8D%E4%BD%9C"><span class="nav-number">12.</span> <span class="nav-text">Testbench中文本文件写入操作</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%85%B3%E9%94%AE%E7%82%B9-10"><span class="nav-number">12.1.</span> <span class="nav-text">1.关键点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%BA%90%E4%BB%A3%E7%A0%81-10"><span class="nav-number">12.2.</span> <span class="nav-text">2.源代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Testbench-10"><span class="nav-number">12.3.</span> <span class="nav-text">3.Testbench</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E4%BB%BF%E7%9C%9F%E7%BB%93%E6%9E%9C-10"><span class="nav-number">12.4.</span> <span class="nav-text">4.仿真结果</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Testbench%E4%B8%AD%E6%96%87%E6%9C%AC%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%93%8D%E4%BD%9C"><span class="nav-number">13.</span> <span class="nav-text">Testbench中文本文件读取操作</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%85%B3%E9%94%AE%E7%82%B9-11"><span class="nav-number">13.1.</span> <span class="nav-text">1.关键点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%BA%90%E4%BB%A3%E7%A0%81-11"><span class="nav-number">13.2.</span> <span class="nav-text">2.源代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Testbench-11"><span class="nav-number">13.3.</span> <span class="nav-text">3.Testbench</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E4%BB%BF%E7%9C%9F%E7%BB%93%E6%9E%9C-11"><span class="nav-number">13.4.</span> <span class="nav-text">4.仿真结果</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E9%9A%8F%E6%9C%BA%E6%95%B0%E7%9A%84%E8%87%AA%E5%8A%A8%E5%8C%96%E4%BB%BF%E7%9C%9F%E6%B5%8B%E8%AF%95"><span class="nav-number">14.</span> <span class="nav-text">基于随机数的自动化仿真测试</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%85%B3%E9%94%AE%E7%82%B9-12"><span class="nav-number">14.1.</span> <span class="nav-text">1.关键点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%BA%90%E4%BB%A3%E7%A0%81-12"><span class="nav-number">14.2.</span> <span class="nav-text">2.源代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Testbench-12"><span class="nav-number">14.3.</span> <span class="nav-text">3.Testbench</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E4%BB%BF%E7%9C%9F%E7%BB%93%E6%9E%9C-12"><span class="nav-number">14.4.</span> <span class="nav-text">4.仿真结果</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%AF%E9%85%8D%E7%BD%AE%E7%9A%84PWM%E8%AE%BE%E8%AE%A1"><span class="nav-number">15.</span> <span class="nav-text">可配置的PWM设计</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%85%B3%E9%94%AE%E7%82%B9-13"><span class="nav-number">15.1.</span> <span class="nav-text">1.关键点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%BA%90%E4%BB%A3%E7%A0%81-13"><span class="nav-number">15.2.</span> <span class="nav-text">2.源代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Testbench-13"><span class="nav-number">15.3.</span> <span class="nav-text">3.Testbench</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E4%BB%BF%E7%9C%9F%E7%BB%93%E6%9E%9C-13"><span class="nav-number">15.4.</span> <span class="nav-text">4.仿真结果</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%B6%85%E5%A3%B0%E6%B3%A2%E6%B5%8B%E8%B7%9D%E8%AE%BE%E8%AE%A1"><span class="nav-number">16.</span> <span class="nav-text">超声波测距设计</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%85%B3%E9%94%AE%E7%82%B9-14"><span class="nav-number">16.1.</span> <span class="nav-text">1.关键点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%BA%90%E4%BB%A3%E7%A0%81-14"><span class="nav-number">16.2.</span> <span class="nav-text">2.源代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Testbench-14"><span class="nav-number">16.3.</span> <span class="nav-text">3.Testbench</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E4%BB%BF%E7%9C%9F%E7%BB%93%E6%9E%9C-14"><span class="nav-number">16.4.</span> <span class="nav-text">4.仿真结果</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E5%94%AE%E5%8D%96%E6%9C%BA%E7%8A%B6%E6%80%81%E6%9C%BA%E8%AE%BE%E8%AE%A1"><span class="nav-number">17.</span> <span class="nav-text">自动售卖机状态机设计</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%85%B3%E9%94%AE%E7%82%B9-15"><span class="nav-number">17.1.</span> <span class="nav-text">1.关键点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%BA%90%E4%BB%A3%E7%A0%81-15"><span class="nav-number">17.2.</span> <span class="nav-text">2.源代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Testbench-15"><span class="nav-number">17.3.</span> <span class="nav-text">3.Testbench</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E4%BB%BF%E7%9C%9F%E7%BB%93%E6%9E%9C-15"><span class="nav-number">17.4.</span> <span class="nav-text">4.仿真结果</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%B2%E5%8F%A3%E6%8C%87%E4%BB%A4%E5%B8%A7%E8%A7%A3%E7%A0%81%E8%AE%BE%E8%AE%A1"><span class="nav-number">18.</span> <span class="nav-text">串口指令帧解码设计</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%85%B3%E9%94%AE%E7%82%B9-16"><span class="nav-number">18.1.</span> <span class="nav-text">1.关键点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%BA%90%E4%BB%A3%E7%A0%81-16"><span class="nav-number">18.2.</span> <span class="nav-text">2.源代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Testbench-16"><span class="nav-number">18.3.</span> <span class="nav-text">3.Testbench</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E4%BB%BF%E7%9C%9F%E7%BB%93%E6%9E%9C-16"><span class="nav-number">18.4.</span> <span class="nav-text">4.仿真结果</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Reference"><span class="nav-number">19.</span> <span class="nav-text">Reference</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ssy"
      src="/images/ssy.png">
  <p class="site-author-name" itemprop="name">ssy</p>
  <div class="site-description" itemprop="description">满怀希望 就会所向披靡</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">144</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">39</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/ssy1938010014" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ssy1938010014" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://m.weibo.cn/u/5469432500?uid=5469432500&t=0&luicode=10000011&lfid=100103type=1&q=JIE%E7%88%B1%E4%BA%86%E6%95%B4%E4%B8%AA%E9%9D%92%E6%98%A5%E7%9A%84%E4%BA%BA" title="Weibo → https:&#x2F;&#x2F;m.weibo.cn&#x2F;u&#x2F;5469432500?uid&#x3D;5469432500&amp;t&#x3D;0&amp;luicode&#x3D;10000011&amp;lfid&#x3D;100103type%3D1%26q%3DJIE%E7%88%B1%E4%BA%86%E6%95%B4%E4%B8%AA%E9%9D%92%E6%98%A5%E7%9A%84%E4%BA%BA" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-link"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://ssy1938010014.github.io/" title="http:&#x2F;&#x2F;ssy1938010014.github.io" rel="noopener" target="_blank">ssy的小天地</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://y006.github.io/" title="http:&#x2F;&#x2F;y006.github.io" rel="noopener" target="_blank">邱院士的Blog</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://bengoooo.github.io/" title="http:&#x2F;&#x2F;BENgoooo.github.io" rel="noopener" target="_blank">赵总的Blog</a>
        </li>
    </ul>
  </div>

      </div>
        <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=1469041281&auto=1&height=66"></iframe>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ssy</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script size="300" alpha="0.6" zIndex="-1" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-ribbon@1/canvas-ribbon.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>


  <script defer src="//cdn.jsdelivr.net/gh/theme-next/theme-next-three@1/three.min.js"></script>
    <script defer src="//cdn.jsdelivr.net/gh/theme-next/theme-next-three@1/three-waves.min.js"></script>


  




  
<script src="/js/local-search.js"></script>









<script data-pjax>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>




    <div id="pjax">
  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
          load: ['[tex]/mhchem'],
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
          packages: {'[+]': ['mhchem']},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

    </div>
</body>
</html>
